<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Shaper Editor</title>
    <link rel="icon" type="image/png" href="icons/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="displaysvg.css">
</head>

<body>
    <div class="container">

        <div class="upload-section flex-center" id="uploadSection">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÅ</div>
                <h3>Upload SVG File</h3>
                <p>Drag and drop your SVG file here or click to browse</p>
                <input type="file" id="fileInput" accept=".svg" hidden>
                <button class="upload-btn no-context-menu" id="uploadBtn">
                    Choose File
                </button>
            </div>
        </div>

        <div class="editor-section" id="editorSection" style="display: none;">
            <!-- Neue Pill-Titelbar √ºber die ganze Breite -->
            <div class="pill-titlebar no-context-menu" id="pillTitlebar">
                <!-- Dateiname und Icon links -->
                <div class="titlebar-filename" id="titlebarFilename" style="display: none;">
                    <span class="filename-spacer" aria-hidden="true"></span>
                    <span class="filename-text"></span>
                </div>

                <!-- Controls rechts -->
                <div class="titlebar-controls">
                    <div class="label-pill-group flex-center-y">
                        <span class="label-pill-label text-muted toggle-label-align">Grid:</span>
                        <input type="checkbox" id="gutterToggle" class="toggle-switch">
                        <label for="gutterToggle" class="toggle-button with-label-pill-align pill-style">
                            <span class="toggle-text left">off</span>
                            <span class="toggle-text right">on</span>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="label-pill-group flex-center-y">
                        <label for="gutterSize" class="label-pill-label text-secondary">Size:</label>
                        <div class="gutter-input-container">
                            <input type="text" id="gutterSize" value="10" placeholder="10" class="pill-style" maxlength="7">
                            <span id="gutterUnitLabel" class="unit-suffix">mm</span>
                        </div>
                    </div>

                    <div class="label-pill-group flex-center-y">
                        <input type="checkbox" id="unitToggle" class="toggle-switch">
                        <label for="unitToggle" class="toggle-button pill-style">
                            <span class="toggle-text left">mm</span>
                            <span class="toggle-text right">in</span>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="label-pill-group flex-center-y">
                        <input type="checkbox" id="decimalToggle" class="toggle-switch">
                        <label for="decimalToggle" class="toggle-button toggle-narrow pill-style">
                            <span class="toggle-text left">.</span>
                            <span class="toggle-text right">,</span>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="label-pill-group flex-center-y">
                        <label for="zoomLevel" class="label-pill-label text-secondary">Zoom:</label>
                        <div class="gutter-input-container">
                            <input type="text" id="zoomLevel" value="100" placeholder="100" class="pill-style" maxlength="5">
                            <span id="zoomUnitLabel" class="unit-suffix">%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="svg-container" id="svgContainer">
                <div class="svg-wrapper" id="svgWrapper">
                    <div class="gutter-overlay" id="gutterOverlay" style="display: none;"></div>
                    <div class="svg-content" id="svgContent"></div>
                </div>


                <!-- Floating Action Buttons -->
                <div class="floating-buttons no-context-menu">
                    <button id="floatingImportBtn"
                        class="floating-btn tooltip-base tooltip-right rounded-full bg-light-grey shadow-sm transition-base no-context-menu"
                        title="Import SVG File">
                        <img src="icons/import.svg" alt="Import" class="floating-btn-icon import-icon" width="24"
                            height="24">
                    </button>
                    <button id="floatingExportBtn"
                        class="floating-btn tooltip-base tooltip-right rounded-full bg-light-grey shadow-sm transition-base no-context-menu"
                        title="Export SVG File">
                        <img src="icons/export.svg" alt="Export" class="floating-btn-icon export-icon" width="16"
                            height="16">
                    </button>
                </div>
                <div class="zoom-controls no-context-menu">
                    <button id="zoomIn"
                        class="floating-btn zoom-btn tooltip-base tooltip-left rounded-full bg-light-grey shadow-sm transition-base no-context-menu"
                        title="Zoom In">+</button>
                    <button id="zoomOut"
                        class="floating-btn zoom-btn tooltip-base tooltip-left rounded-full bg-light-grey shadow-sm transition-base no-context-menu"
                        title="Zoom Out">‚Äì</button>
                    <button id="zoom100"
                        class="floating-btn zoom-btn tooltip-base tooltip-left rounded-full bg-light-grey shadow-sm transition-base no-context-menu"
                        title="Reset to 100%">1:1</button>
                    <button id="centerView"
                        class="floating-btn tooltip-base tooltip-left rounded-full bg-light-grey shadow-sm transition-base no-context-menu"
                        title="Center View">
                        <img src="icons/center.svg" alt="Center" class="floating-btn-icon" width="16" height="16">
                    </button>
                    <button id="zoomFit"
                        class="floating-btn zoom-btn tooltip-base tooltip-left rounded-full bg-light-grey shadow-sm transition-base no-context-menu"
                        title="Fit to Screen">
                        <img src="icons/fit-to-screen.svg" alt="Fit to Screen" class="floating-btn-icon" width="16"
                            height="16">
                    </button>
                </div>
            </div>
        </div>

        <!-- Attribute Editing Modal -->
        <div class="modal no-context-menu" id="attributeModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Edit Shaper Attributes</h3>
                    <button class="modal-close" id="modalClose">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="path-info">
                        <strong>Selected Path:</strong>
                        <span id="selectedPathInfo"></span>
                    </div>
                    <form id="attributeForm">
                        <div class="form-group">
                            <label for="cutType">Cut Type:</label>
                            <div class="cut-type-slider">
                                <div class="cut-type-options">
                                    <div class="cut-type-option" data-type="">none</div>
                                    <div class="cut-type-option" data-type="online">Online</div>
                                    <div class="cut-type-option" data-type="inside">Inside</div>
                                    <div class="cut-type-option" data-type="outside">Outside</div>
                                    <div class="cut-type-option" data-type="pocket">Pocket</div>
                                    <div class="cut-type-option" data-type="guide">Guide</div>
                                </div>
                                <div class="cut-type-indicator"></div>
                            </div>
                            <input type="hidden" id="cutType" name="cutType" value="">
                        </div>
                        <div class="form-group">
                            <label for="cutDepth">Cut Depth:</label>
                            <div class="input-with-unit">
                                <input type="text" id="cutDepth" name="cutDepth" placeholder="15"
                                    class="border-light rounded-sm">
                                <span class="input-unit">mm</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="cutOffset">Cut Offset:</label>
                            <div class="input-with-unit">
                                <input type="text" id="cutOffset" name="cutOffset" placeholder="0"
                                    class="border-light rounded-sm">
                                <span class="input-unit">mm</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="toolDia">Tool Diameter:</label>
                            <div class="input-with-unit">
                                <input type="text" id="toolDia" name="toolDia" placeholder="6"
                                    class="border-light rounded-sm">
                                <span class="input-unit">mm</span>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="modalCancel"
                        class="btn btn-secondary rounded transition-base border-light">Cancel</button>
                    <button type="button" id="modalSave" class="btn btn-primary rounded transition-base">Save
                        Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modular JavaScript files -->
    <script src="js/shaperConstants.js"></script>
    <script src="js/measurementSystem.js"></script>
    <script src="js/metaData.js"></script>
    <script src="js/elementManager.js"></script>
    <script src="js/viewport.js"></script>
    <script src="js/uiComponents.js"></script>
    <script src="js/svgHelper.js"></script>
    <script src="js/fileManager.js"></script>
    <script src="js/attributeSystem.js"></script>
    <script src="js/svgShaperEditor.js"></script>
    <script>
        // Only allow digits, dot, and comma in size and zoom inputs
        function filterNumericInput(e) {
            const allowed = /[0-9.,]/;
            if (!allowed.test(e.key) && e.key.length === 1) {
                e.preventDefault();
            }
        }
        document.getElementById('gutterSize').addEventListener('keypress', filterNumericInput);
        document.getElementById('zoomLevel').addEventListener('keypress', filterNumericInput);
    </script>
</body>

</html>