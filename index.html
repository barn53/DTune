<!doctypehtml><html lang="en"><meta charset="UTF-8"><meta name="viewport"content="width=device-width,initial-scale=1"><title>SVG Shaper Editor</title><link rel="preconnect"href="https://fonts.googleapis.com"><link rel="preconnect"href="https://fonts.gstatic.com"crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap"rel="stylesheet"><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;background:0 0;min-height:100vh;color:#333;margin:0;padding:0;overflow:hidden}.rounded-sm{border-radius:4px}.rounded{border-radius:8px}.rounded-pill{border-radius:20px}.rounded-full{border-radius:50%}.shadow-sm{box-shadow:0 4px 12px rgba(0,0,0,.15)}.shadow-pill{box-shadow:0 2px 8px rgba(0,0,0,.1)}.shadow{box-shadow:0 4px 12px rgba(0,0,0,.1)}.shadow-lg{box-shadow:0 6px 20px rgba(0,0,0,.25)}.transition-base{transition:all .2s ease}.bg-light-grey{background:#e8e8e8}.bg-hover-grey{background:#d0d0d0}.border-light{border:none}.flex{display:flex}.inline-flex{display:inline-flex}.flex-center{display:flex;align-items:center;justify-content:center}.flex-center-y{display:flex;align-items:center}.flex-center-x{display:flex;justify-content:center}.text-primary{color:#333}.text-secondary{color:#333}.text-muted{color:#333}.pill-style{background:#e8e8e8;border-radius:20px;box-shadow:0 2px 8px rgba(0,0,0,.1);transition:all .2s ease;height:32px;display:inline-flex;align-items:center;justify-content:center}.pill-style:hover{background:#d0d0d0;box-shadow:0 4px 12px rgba(0,0,0,.15);transform:scale(1.1)}.pill-style:active{transform:scale(.95)}.container{width:100vw;height:100vh;margin:0;padding:0;background:0 0}header h1{font-size:2.5rem;font-weight:300;margin-bottom:10px}header p{font-size:1.1rem;opacity:.9}.upload-section{width:100vw;height:100vh}.upload-area{background:#fff;border:3px dashed #667eea;border-radius:20px;padding:60px 40px;text-align:center;cursor:pointer;transition:all .3s ease;max-width:500px;width:100%}.upload-area:hover{border-color:#764ba2;background:#f8f9ff;transform:translateY(-5px);box-shadow:0 20px 40px rgba(102,126,234,.2)}.upload-area.dragover{border-color:#764ba2;background:#f0f2ff;transform:scale(1.02)}.upload-area.drag-over{border-color:#764ba2;background:#f0f2ff;transform:scale(1.02)}.upload-icon{font-size:3rem;margin-bottom:20px}.upload-area h3{font-size:1.5rem;margin-bottom:10px;color:#333}.upload-area p{color:#666;margin-bottom:30px}.btn{border:none;padding:12px 24px;font-size:14px;font-weight:500;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:8px}.btn-primary{background:#667eea;color:#fff}.btn-primary:hover{background:#5a6fd8;transform:translateY(-2px);box-shadow:0 4px 12px rgba(102,126,234,.3)}.btn-secondary{background:#f8f9fa;color:#333}.btn-secondary:hover{background:#e9ecef;transform:translateY(-2px)}.upload-btn{background:#667eea;color:#fff;padding:15px 30px;border-radius:10px;font-size:16px;font-weight:500;border:none;cursor:pointer;transition:all .3s ease}.upload-btn:hover{background:#5a6fd8;transform:translateY(-2px);box-shadow:0 8px 25px rgba(102,126,234,.3)}.editor-section{width:100vw;height:100vh;position:relative;background:#fff;overflow:hidden}.pill-titlebar{position:absolute;top:12px;left:16px;right:16px;padding:12px 24px;background:rgba(255,255,255,.15);backdrop-filter:blur(10px) saturate(140%);-webkit-backdrop-filter:blur(10px) saturate(140%);border:1px solid rgba(255,255,255,.2);border-radius:30px;box-shadow:0 8px 24px rgba(2,6,23,.25);z-index:1000;display:flex;align-items:center;justify-content:space-between;transition:all .3s ease;min-height:56px}@supports not ((backdrop-filter:blur(0)) or (-webkit-backdrop-filter:blur(0))){.pill-titlebar{background:rgba(255,255,255,.85)}}.titlebar-filename{display:flex;align-items:center;color:#333;font-size:20px;font-weight:600;line-height:1.2}.titlebar-filename::before{content:'';display:inline-block;width:32px;height:32px;background:url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCAzNiAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBpY29uPSJzaGFwZXItaWNvbiIKICAgIGRhdGEtY3k9ImFwcGxpY2F0aW9uLW1lbnUtbGF1bmNoZXIiPgogICAgPHBhdGggZD0iTTIzLjQ3NjEgMjEuOTA4NkwxMi40NzA0IDIxLjg5NjNMMTcuOTk1OSAxMi4yNzcxTDIzLjQ3NjEgMjEuOTA4NloiIGZpbGw9ImN1cnJlbnRDb2xvciI+PC9wYXRoPgogICAgPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9ImN1cnJlbnRDb2xvciIKICAgICAgICBkPSJNNy45OTYzMiAzLjAzNTgzQzEwLjk1NiAxLjA1NzI5IDE0LjQzNTggMC4wMDA4MTM4MjIgMTcuOTk1OSAwQzIyLjc2ODUgMC4wMDMyNjY1MSAyNy4zNDQ3IDEuOTAwMDQgMzAuNzIwMiA1LjI3Mzk4QzM0LjA5NTcgOC42NDc5MiAzNS45OTQ2IDEzLjIyMzMgMzYgMTcuOTk1OUMzNi4wMDA4IDIxLjU1NTkgMzQuOTQ1OSAyNS4wMzYzIDMyLjk2ODcgMjcuOTk2OEMzMC45OTE2IDMwLjk1NzQgMjguMTgwOSAzMy4yNjUxIDI0Ljg5MjEgMzQuNjI4M0MyMS42MDMzIDM1Ljk5MTQgMTcuOTg0MiAzNi4zNDg3IDE0LjQ5MjQgMzUuNjU0OUMxMS4wMDA2IDM0Ljk2MTIgNy43OTI5MiAzMy4yNDc2IDUuMjc0OTkgMzAuNzMwOEMyLjc1NzA3IDI4LjIxNDEgMS4wNDIwMSAyNS4wMDcyIDAuMzQ2Njc2IDIxLjUxNTdDLTAuMzQ4NjU2IDE4LjAyNDIgMC4wMDY5NzY5MSAxNC40MDQ5IDEuMzY4NiAxMS4xMTU1QzIuNzMwMjMgNy44MjYxMiA1LjAzNjY5IDUuMDE0MzcgNy45OTYzMiAzLjAzNTgzWk0xMC45NjA1IDIzLjcxODlIMjUuMDE0OUMyNS43NTEzIDIzLjcxODkgMjYuMjk0NCAyMi45NjE4IDI1Ljc1NTQgMjIuMDIzOEwxOC45NzEgMTAuMjA3NUMxOC40MzIgOS4yNjUzNyAxNy41NTk4IDkuMjY1MzcgMTcuMDI0OSAxMC4yMDc1TDEwLjIzNjMgMjIuMDIzOEM5LjcwNTYxIDIyLjk1NzcgMTAuMjYxIDIzLjcxODkgMTAuOTYwNSAyMy43MTg5WiI+CiAgICA8L3BhdGg+Cjwvc3ZnPg==') center center/contain no-repeat;flex:0 0 32px;margin-right:12px}.titlebar-filename .filename-text{max-width:300px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.titlebar-controls{display:flex;align-items:center;gap:15px;flex-shrink:0}.toolbar-label{font-weight:500;font-size:14px;line-height:1;margin:0;display:inline-block;vertical-align:baseline}.label-pill-group{display:inline-flex;align-items:center;vertical-align:middle}.label-pill-label{vertical-align:middle;margin-bottom:0;color:#333}.label-pill-label{margin-right:14px;color:#333}.label-pill-label:focus,.label-pill-label:hover{background:0 0!important;color:inherit!important;cursor:default}.pill-baseline{width:75px;display:inline-block;text-align:center;line-height:32px;vertical-align:baseline;padding:0;margin:0;transform:translateY(0);position:static}.btn-base{padding:8px 16px;border:none;cursor:pointer;font-size:14px;font-weight:500;text-align:center;display:inline-flex;align-items:center;justify-content:center;gap:6px}.btn-primary{background:#667eea;color:#fff}.btn-primary:hover{background:#5a67d8}.btn-secondary{background:#e2e8f0;color:#4a5568}.btn-secondary:hover{background:#cbd5e0}.input-base{padding:8px 12px;border:1px solid #e2e8f0;font-size:14px;outline:0}.input-base:focus{border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}.input-group{display:flex;align-items:center;gap:8px}.floating-base{position:fixed;z-index:1000}.floating-left{left:20px;top:50%;transform:translateY(-50%)}.floating-right{right:20px;bottom:20px}.toolbar-base{height:60px;padding:0 20px;border-bottom:1px solid #e2e8f0}.toolbar-section{display:flex;align-items:center;gap:16px}.toolbar-divider{width:1px;height:24px;background:#e2e8f0;margin:0 8px}.toolbar-right input[type=text]{width:60px;padding:4px 8px;font-size:14px;background:#fff!important;transition:all .2s ease}.toolbar-right input[type=text]{transform:none!important}.gutter-input-container{position:relative;width:105px;height:32px;display:inline-flex;align-items:center;vertical-align:middle;border-radius:20px;background:#e8e8e8;transition:transform .2s cubic-bezier(.4, 0, .2, 1),box-shadow .2s cubic-bezier(.4, 0, .2, 1),background .2s cubic-bezier(.4, 0, .2, 1);overflow:hidden;margin-top:2px}.gutter-input-container:hover{transform:scale(1.05);background:#f0f0f0;box-shadow:0 4px 12px rgba(0,0,0,.15)}.gutter-input-container:focus-within{transform:scale(1.05);background:#fff;box-shadow:0 4px 12px rgba(0,0,0,.15)}.gutter-input-container input{width:100%;min-width:0;box-sizing:border-box;padding:0 38px 0 12px!important;height:32px;line-height:32px;font-size:14px;background:#fff!important;border:none!important;outline:0!important;text-align:right;transition:background .2s cubic-bezier(.4, 0, .2, 1);box-shadow:none!important;position:relative;z-index:1;transform:none!important;vertical-align:middle;flex:1 1 auto;overflow-x:auto;white-space:nowrap}.unit-suffix{position:absolute;right:8px;top:50%;transform:translateY(-50%);font-size:12px;color:#6c757d;font-weight:600;pointer-events:none;background:0 0;padding-left:2px;padding-right:2px;border-radius:3px;z-index:2;display:block!important;opacity:1!important;text-align:left;width:22px}.toggle-group{display:flex;align-items:center;gap:8px}.toggle-label-pill-align{transform:translateY(4px)}.toggle-label-align{transform:translateY(4px)}.toggle-switch{display:none}.toggle-button{position:relative;width:80px;cursor:pointer;overflow:hidden;transform:translateY(1px)}.toggle-button.toggle-narrow{width:70px}.toggle-button:hover{transform:translateY(1px) scale(1.1)}.toggle-text{position:absolute;top:0;bottom:0;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;transition:all .2s ease;z-index:2;pointer-events:none}.toggle-button .toggle-text.left{left:0;color:#fff;width:50%}.toggle-button .toggle-text.right{right:0;color:#6c757d;width:50%}.toggle-button.toggle-narrow .toggle-text{font-size:18px;font-weight:600;width:50%}.toggle-button.toggle-with-label .toggle-text{font-size:12px;width:50%}.toggle-slider{position:absolute;top:0;left:0;height:32px;transition:all .2s ease;border-radius:15px;z-index:1}.toggle-button .toggle-slider{width:50%;background:linear-gradient(145deg,#007bff,#0056b3);box-shadow:0 1px 3px rgba(0,123,255,.4)}.toggle-button.toggle-narrow .toggle-slider{background:linear-gradient(145deg,#6f42c1,#5a2d8f);box-shadow:0 1px 3px rgba(111,66,193,.4)}.toggle-button.toggle-with-label .toggle-slider{background:linear-gradient(145deg,#dc3545,#c82333);box-shadow:0 1px 3px rgba(220,53,69,.4)}.toggle-switch:checked+.toggle-button .toggle-slider{transform:translateX(calc(100% + 2px))}.toggle-switch:checked+.toggle-button .toggle-text.left{color:#6c757d}.toggle-switch:checked+.toggle-button .toggle-text.right{color:#fff}.toggle-switch:checked+.toggle-button .toggle-slider{background:linear-gradient(145deg,#28a745,#1e7e34);box-shadow:0 1px 3px rgba(40,167,69,.4)}.toggle-switch:checked+.toggle-button.toggle-narrow .toggle-slider{background:linear-gradient(145deg,#fd7e14,#e8630c);box-shadow:0 1px 3px rgba(253,126,20,.4)}.toggle-button:active{transform:translateY(2px) scale(.95);box-shadow:0 1px 2px rgba(0,0,0,.1)}.svg-container{position:absolute;top:0;left:0;right:0;bottom:0;width:100vw;height:100vh;background:0 0!important;overflow:hidden}.svg-wrapper{position:relative;width:100%;height:100%;overflow:hidden;cursor:grab}.svg-wrapper.dragging{cursor:grabbing}.svg-content{position:absolute;top:0;left:0;width:100%;height:100%;display:block;transform-origin:0 0;z-index:1}.svg-content svg{max-width:100%;max-height:100%;user-select:none;background:0 0!important;fill:none!important}.svg-content svg circle,.svg-content svg ellipse,.svg-content svg line,.svg-content svg path,.svg-content svg polygon,.svg-content svg polyline,.svg-content svg rect{transition:all .3s ease!important;pointer-events:none}.svg-content svg .no-export{pointer-events:all!important}.svg-content svg .path-overlay{fill:none!important;stroke:transparent!important;stroke-width:8!important;pointer-events:all!important;opacity:0;cursor:pointer}.svg-content svg circle.hover-active,.svg-content svg ellipse.hover-active,.svg-content svg line.hover-active,.svg-content svg path.hover-active,.svg-content svg polygon.hover-active,.svg-content svg polyline.hover-active,.svg-content svg rect.hover-active{stroke:#8fa4f3!important;stroke-width:2!important;filter:drop-shadow(0 0 3px rgba(143, 164, 243, .5))!important}.svg-content svg circle.selected,.svg-content svg ellipse.selected,.svg-content svg line.selected,.svg-content svg path.selected,.svg-content svg polygon.selected,.svg-content svg polyline.selected,.svg-content svg rect.selected{stroke:#667eea!important;stroke-width:4!important;filter:drop-shadow(0 0 12px rgba(102, 126, 234, .9)) drop-shadow(0 0 24px rgba(102, 126, 234, .5)) brightness(1.15);transform:scale(1.03);animation:selectedPulse 2s ease-in-out infinite}@keyframes selectedPulse{0%,100%{filter:drop-shadow(0 0 12px rgba(102, 126, 234, .9)) drop-shadow(0 0 24px rgba(102, 126, 234, .5)) brightness(1.15)}50%{filter:drop-shadow(0 0 16px rgba(102, 126, 234, 1)) drop-shadow(0 0 32px rgba(102, 126, 234, .7)) brightness(1.25)}}.svg-boundary-outline{fill:none!important;stroke:rgba(50,205,50,0.4)!important;stroke-width:2!important;stroke-dasharray:6,3!important;pointer-events:none!important;transition:stroke .2s ease!important}.svg-boundary-outline.boundary-highlight{stroke:rgba(50,205,50,0.8)!important;stroke-width:2!important}.boundary-overlay{pointer-events:all!important;cursor:pointer!important}.gutter-overlay{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;background-image:linear-gradient(rgba(192,192,192,.4) 1px,transparent 1px),linear-gradient(90deg,rgba(192,192,192,.4) 1px,transparent 1px);background-size:10px 10px;z-index:500}.gutter-intersection{border-radius:1px;box-sizing:border-box}.zoom-controls{position:absolute;top:130px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:100}.zoom-btn{font-size:16px;font-weight:600;color:#333;line-height:1.2;text-align:center;padding-top:2px}#zoomOut{margin-top:-1px}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);backdrop-filter:blur(5px);display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content{background:#fff;border-radius:16px;box-shadow:0 25px 80px rgba(0,0,0,.25);max-width:650px;width:90%;max-height:80vh;overflow:hidden;animation:modalSlideIn .3s ease}@keyframes modalSlideIn{from{opacity:0;transform:translateY(-50px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.modal-header{padding:20px 20px 0 20px;display:flex;justify-content:space-between;align-items:center}.modal-header h3{font-size:1.5rem;font-weight:500;color:#333}.modal-close{background:0 0;border:none;font-size:24px;cursor:pointer;color:#999;width:30px;height:30px;display:flex;justify-content:center;align-items:center;border-radius:50%;transition:all .2s ease}.modal-close:hover{background:#f5f5f5;color:#333}.modal-body{padding:20px;max-height:60vh;overflow-y:auto}.path-info{background:#f8f9fa;padding:15px;border-radius:8px;margin-bottom:20px;font-size:14px}.form-group{margin-bottom:20px}.form-group label{display:block;margin-bottom:6px;font-weight:500;color:#333;font-size:14px}.form-group input{width:100%;padding:10px 12px;border-radius:6px;font-size:14px}.form-group input:focus{outline:0;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}.form-group input::placeholder,.gutter-input-container input::placeholder,.toolbar-right input[type=text]::placeholder{color:#adb5bd;opacity:.7}.input-with-unit{position:relative;display:inline-block;width:100%}.input-with-unit input{padding-right:35px!important;width:100%}.input-unit{position:absolute;right:8px;top:50%;transform:translateY(-50%);font-size:12px;color:#6c757d;font-weight:600;pointer-events:none;background:#f8f9fa;padding:2px 4px;border-radius:3px}.modal-footer{padding:20px;border-top:1px solid #e9ecef;display:flex;justify-content:flex-end;gap:10px}.cut-type-slider{position:relative;background:#f8f9fa;border:2px solid #e9ecef;border-radius:8px;padding:4px;margin-top:8px;overflow:hidden}.cut-type-options{display:flex;position:relative;z-index:2}.cut-type-option{flex:1;padding:10px 0;font-size:13px;font-weight:600;color:#6c757d;cursor:pointer;transition:color .2s ease;user-select:none;text-align:center;background:0 0;border:none;outline:0}.cut-type-option:hover{color:#495057}.cut-type-option.active{color:#fff}.cut-type-indicator{position:absolute;top:4px;left:0;height:calc(100% - 8px);background:linear-gradient(145deg,#007bff,#0056b3);border-radius:4px;transition:all .3s cubic-bezier(.4, 0, .2, 1);box-shadow:0 2px 8px rgba(0,123,255,.3);z-index:1}.shaper-tooltip{position:absolute;background:linear-gradient(145deg,#2c3e50,#34495e);color:#fff;padding:12px 16px;border-radius:8px;font-size:13px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;font-weight:500;line-height:1.5;max-width:280px;z-index:1000;pointer-events:none;box-shadow:0 8px 24px rgba(0,0,0,.4);border:1px solid rgba(255,255,255,.1);opacity:0;transform:translateY(10px);transition:opacity .2s ease,transform .2s ease}.shaper-tooltip.visible{opacity:1;transform:translateY(0)}.shaper-tooltip .tooltip-title{font-weight:700;font-size:14px;margin-bottom:8px;color:#fff;border-bottom:2px solid #3498db;padding-bottom:6px}.shaper-tooltip .tooltip-attribute{margin:4px 0;display:flex;justify-content:space-between;gap:12px}.shaper-tooltip .attr-name{color:#bdc3c7;font-weight:600}.shaper-tooltip .attr-value{color:#fff;font-weight:700;font-family:Consolas,Monaco,monospace}.shaper-tooltip .no-attributes{color:#95a5a6;font-style:italic;font-weight:500}.shaper-tooltip .tooltip-section{margin-bottom:12px}.shaper-tooltip .tooltip-section:last-child{margin-bottom:0}.shaper-tooltip .section-title{font-weight:700;color:#ecf0f1;font-size:12px;margin-bottom:8px;text-transform:uppercase;letter-spacing:.8px;border-bottom:1px solid rgba(236,240,241,.3);padding-bottom:4px}.shaper-tooltip .tooltip-measurement{display:flex;justify-content:space-between;padding:3px 0;font-size:13px}.shaper-tooltip .measurement-name{color:#bdc3c7;font-weight:600}.shaper-tooltip .measurement-value{color:#f39c12;font-weight:700;font-family:Consolas,Monaco,monospace}.floating-buttons{position:absolute;left:20px;top:130px;display:flex;flex-direction:column;gap:15px;z-index:1000;pointer-events:none}.floating-btn{width:40px;height:40px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;pointer-events:auto;position:relative;line-height:1.2;text-align:center;padding-top:1px}.floating-btn:hover{transform:scale(1.1);background:#007bff!important;color:#fff!important}.floating-btn:hover .floating-btn-icon{filter:brightness(0) invert(1)}.floating-btn:hover .floating-btn-icon path{fill:white!important}.bg-light-grey:hover{background:#007bff!important}.shadow-sm:hover{box-shadow:0 6px 20px rgba(0,0,0,.25)!important}.floating-btn:active{transform:scale(.95)}.floating-btn-icon{width:16px;height:16px;fill:#000;stroke:none}.floating-btn-icon.import-icon{width:24px;height:24px;fill:none}.floating-btn-icon.import-icon path{fill:#000}.floating-btn-icon.export-icon{fill:none}.tooltip-base::before{content:attr(title);position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.8);color:#fff;padding:8px 12px;border-radius:6px;font-size:12px;white-space:nowrap;opacity:0;visibility:hidden;transition:all .3s ease;pointer-events:none;z-index:1001}.tooltip-base:hover::before{opacity:1;visibility:visible}.tooltip-base::after{content:'';position:absolute;top:50%;transform:translateY(-50%);width:0;height:0;border-top:5px solid transparent;border-bottom:5px solid transparent;opacity:0;visibility:hidden;transition:all .3s ease}.tooltip-base:hover::after{opacity:1;visibility:visible}.tooltip-right::before{left:50px}.tooltip-right::after{left:40px;border-right:8px solid rgba(0,0,0,.8)}.tooltip-left::before{right:50px}.tooltip-left::after{right:40px;border-left:8px solid rgba(0,0,0,.8)}.floating-btn-icon.export-icon path{fill:#000}@media (max-width:768px){.container{padding:10px}header h1{font-size:2rem}.upload-area{padding:40px 20px}.toolbar{flex-direction:column;align-items:stretch}.toolbar-right{justify-content:center}.svg-container{height:50vh}.zoom-controls{position:relative;margin:10px auto;flex-direction:row;justify-content:center;gap:10px}.modal-content{margin:20px;width:calc(100% - 40px)}.floating-buttons{left:10px;gap:10px}.floating-btn{width:36px;height:36px}.floating-btn-icon{width:14px;height:14px}.floating-btn-icon.import-icon{width:20px;height:20px}.floating-btn::before{left:46px;font-size:11px;padding:6px 10px}.floating-btn::after{left:36px}.tooltip-right::before{left:46px;font-size:11px;padding:6px 10px}.tooltip-right::after{left:36px}.tooltip-left::before{right:46px;font-size:11px;padding:6px 10px}.tooltip-left::after{right:36px}}.context-menu-backdrop{position:fixed;top:0;left:0;width:100vw;height:100vh;backdrop-filter:blur(2px);background:rgba(0,0,0,.1);z-index:9999;display:none}.custom-context-menu{position:fixed;background:linear-gradient(145deg,#2c3e50,#34495e);border:1px solid rgba(255,255,255,.1);border-radius:12px;backdrop-filter:blur(12px);box-shadow:0 12px 40px rgba(0,0,0,.4);padding:12px 8px;min-width:200px;max-width:200px;z-index:10000;display:none;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;font-size:13px;animation:contextMenuAppear .2s ease-out}.context-menu-item{display:flex;align-items:center;justify-content:flex-start;width:calc(100% - 12px);padding:10px 14px;margin:6px 6px;border:none;border-radius:8px;background:rgba(52,73,94,.6);color:#ecf0f1;font-family:inherit;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s ease;text-align:left;border:1px solid rgba(255,255,255,.05)}.context-menu-item:hover{transform:scale(1.02);background:rgba(52,152,219,.8);color:#fff;border:1px solid rgba(52,152,219,.3)}.context-menu-item:hover .context-menu-icon{filter:brightness(0) invert(1)}.context-menu-item:active{transform:scale(.98);background:rgba(41,128,185,.9)}.context-menu-icon{width:16px;height:16px;margin-right:12px;flex-shrink:0;opacity:.9;filter:brightness(0) invert(1)}.context-menu-separator{height:1px;background:rgba(236,240,241,.3);margin:8px 12px;border:none}@keyframes contextMenuAppear{0%{opacity:0;transform:scale(.95) translateY(-5px)}100%{opacity:1;transform:scale(1) translateY(0)}}</style><div class="container"><div class="upload-section flex-center"id="uploadSection"><div class="upload-area"id="uploadArea"><div class="upload-icon">📁</div><h3>Upload SVG File</h3><p>Drag and drop your SVG file here or click to browse</p><input type="file"id="fileInput"accept=".svg"hidden> <button class="upload-btn no-context-menu"id="uploadBtn">Choose File</button></div></div><div class="editor-section"id="editorSection"style="display:none"><div class="pill-titlebar no-context-menu"id="pillTitlebar"><div class="titlebar-filename"id="titlebarFilename"style="display:none"><span class="filename-spacer"aria-hidden="true"></span> <span class="filename-text"></span></div><div class="titlebar-controls"><div class="label-pill-group flex-center-y"><span class="label-pill-label text-muted toggle-label-align">Grid:</span> <input type="checkbox"id="gutterToggle"class="toggle-switch"> <label for="gutterToggle"class="toggle-button with-label-pill-align pill-style"><span class="toggle-text left">off</span> <span class="toggle-text right">on</span> <span class="toggle-slider"></span></label></div><div class="label-pill-group flex-center-y"><label for="gutterSize"class="label-pill-label text-secondary">Size:</label><div class="gutter-input-container"><input id="gutterSize"value="10"placeholder="10"class="pill-style"maxlength="7"> <span id="gutterUnitLabel"class="unit-suffix">mm</span></div></div><div class="label-pill-group flex-center-y"><input type="checkbox"id="unitToggle"class="toggle-switch"> <label for="unitToggle"class="toggle-button pill-style"><span class="toggle-text left">mm</span> <span class="toggle-text right">in</span> <span class="toggle-slider"></span></label></div><div class="label-pill-group flex-center-y"><input type="checkbox"id="decimalToggle"class="toggle-switch"> <label for="decimalToggle"class="toggle-button toggle-narrow pill-style"><span class="toggle-text left">.</span> <span class="toggle-text right">,</span> <span class="toggle-slider"></span></label></div><div class="label-pill-group flex-center-y"><label for="zoomLevel"class="label-pill-label text-secondary">Zoom:</label><div class="gutter-input-container"><input id="zoomLevel"value="100"placeholder="100"class="pill-style"maxlength="5"> <span id="zoomUnitLabel"class="unit-suffix">%</span></div></div></div></div><div class="svg-container"id="svgContainer"><div class="svg-wrapper"id="svgWrapper"><div class="gutter-overlay"id="gutterOverlay"style="display:none"></div><div class="svg-content"id="svgContent"></div></div><div class="floating-buttons no-context-menu"><button id="floatingImportBtn"class="floating-btn tooltip-base tooltip-right rounded-full bg-light-grey shadow-sm transition-base no-context-menu"title="Import SVG File"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICAgY2xhc3M9ImZsb2F0aW5nLWJ0bi1pY29uIGltcG9ydC1pY29uIj4KICAgIDxwYXRoCiAgICAgICAgZD0iTTEyIDMuNTg1NzhMNy4yOTI4OSA4LjI5Mjg5TDguNzA3MTEgOS43MDcxMUwxMSA3LjQxNDIxVjE1SDEzVjcuNDE0MjFMMTUuMjkyOSA5LjcwNzExTDE2LjcwNzEgOC4yOTI4OUwxMiAzLjU4NTc4WiIKICAgICAgICBmaWxsPSIjMTYxNTE0Ij48L3BhdGg+CiAgICA8cGF0aCBkPSJNNCAxNVYyMEgyMFYxNUgxOFYxOEg2VjE1SDRaIiBmaWxsPSIjMTYxNTE0Ij48L3BhdGg+Cjwvc3ZnPg=="alt="Import"class="floating-btn-icon import-icon"width="24"height="24"></button> <button id="floatingExportBtn"class="floating-btn tooltip-base tooltip-right rounded-full bg-light-grey shadow-sm transition-base no-context-menu"title="Export SVG File"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTciIHZpZXdCb3g9IjAgMCAxNCAxNyIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICBjbGFzcz0iZmxvYXRpbmctYnRuLWljb24gZXhwb3J0LWljb24iPgogICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTEwIDZIMTRMNyAxM0wwIDZINFYwSDEwVjZaTTAgMTdWMTVIMTRWMTdIMFoiIGZpbGw9IiMwMDAiPjwvcGF0aD4KPC9zdmc+"alt="Export"class="floating-btn-icon export-icon"width="16"height="16"></button></div><div class="zoom-controls no-context-menu"><button id="zoomIn"class="floating-btn zoom-btn tooltip-base tooltip-left rounded-full bg-light-grey shadow-sm transition-base no-context-menu"title="Zoom In">+</button> <button id="zoomOut"class="floating-btn zoom-btn tooltip-base tooltip-left rounded-full bg-light-grey shadow-sm transition-base no-context-menu"title="Zoom Out">–</button> <button id="zoom100"class="floating-btn zoom-btn tooltip-base tooltip-left rounded-full bg-light-grey shadow-sm transition-base no-context-menu"title="Reset to 100%">1:1</button> <button id="centerView"class="floating-btn tooltip-base tooltip-left rounded-full bg-light-grey shadow-sm transition-base no-context-menu"title="Center View"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDE2IDE2IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zOnNlcmlmPSJodHRwOi8vd3d3LnNlcmlmLmNvbS8iIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtzdHJva2UtbGluZWNhcDpyb3VuZDsiPgogICAgPHBhdGggZD0iTTgsMUw4LDRNOCwxMkw4LDE1TTEsOEw0LDhNMTIsOEwxNSw4IiBzdHlsZT0iZmlsbDpub25lO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MXB4OyIvPgogICAgPHBhdGggZD0iTTEuMDE0LDEuMDMxTDEuMDE0LDMuNTM2IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS41cHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsNi45ODU3Miw1LjcxNjcxKSI+CiAgICAgICAgPHBhdGggZD0iTTEuMDE0LDEuMDMxTDEuMDE0LDMuNTM2IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS41cHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDEuMjUwMTksMCwwLDEsLTAuMjU0Nzc1LDApIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTgsMS4wMjdMMy4wMTgsMS4wMjciIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjMzcHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDYuMTIzMjNlLTE3LDEsLTEsNi4xMjMyM2UtMTcsMTYuMDI3NCwwLjAxMzA3MTgpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTQsMS4wMzFMMS4wMTQsMy41MzYiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjVweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoNi4xMjMyM2UtMTcsMSwtMSw2LjEyMzIzZS0xNywxMC4yODMzLDYuOTg1NzIpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTQsMS4wMzFMMS4wMTQsMy41MzYiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjVweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoNy42NTUyMWUtMTcsMS4yNTAxOSwtMSw2LjEyMzIzZS0xNywxNi4wMjc0LC0wLjI0MTcwNCkiPgogICAgICAgIDxwYXRoIGQ9Ik0xLjAxOCwxLjAyN0wzLjAxOCwxLjAyNyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjEuMzNweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoLTEsLTEuMjI0NjVlLTE2LDEuMjI0NjVlLTE2LC0xLDE2LDE2LjAyNzQpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTQsMS4wMzFMMS4wMTQsMy41MzYiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjVweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoLTEuMjUwMTksLTEuNTMxMDRlLTE2LDEuMjI0NjVlLTE2LC0xLDE2LjI1NDgsMTYuMDI3NCkiPgogICAgICAgIDxwYXRoIGQ9Ik0xLjAxOCwxLjAyN0wzLjAxOCwxLjAyNyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjEuMzNweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoNi4xMjMyM2UtMTcsLTEsMSw2LjEyMzIzZS0xNywtMC4wMjczNTYsMTYuMDE0MykiPgogICAgICAgIDxwYXRoIGQ9Ik0xLjAxNCwxLjAzMUwxLjAxNCwzLjUzNiIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjEuNXB4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8L2c+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCg3LjY1NTIxZS0xNywtMS4yNTAxOSwxLDYuMTIzMjNlLTE3LC0wLjAyNzM1NiwxNi4yNjkxKSI+CiAgICAgICAgPHBhdGggZD0iTTEuMDE4LDEuMDI3TDMuMDE4LDEuMDI3IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS4zM3B4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8L2c+Cjwvc3ZnPgo="alt="Center"class="floating-btn-icon"width="16"height="16"></button> <button id="zoomFit"class="floating-btn zoom-btn tooltip-base tooltip-left rounded-full bg-light-grey shadow-sm transition-base no-context-menu"title="Fit to Screen"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDE2IDE2IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zOnNlcmlmPSJodHRwOi8vd3d3LnNlcmlmLmNvbS8iIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtzdHJva2UtbGluZWNhcDpyb3VuZDsiPgogICAgPHBhdGggZD0iTTgsM0w4LDZNOCwxMEw4LDEzTTMsOEw2LDhNMTAsOEwxMyw4IiBzdHlsZT0iZmlsbDpub25lO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MXB4OyIvPgogICAgPHBhdGggZD0iTTgsM0w3LDQiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDxwYXRoIGQ9Ik0xMyw4TDEyLDkiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDxwYXRoIGQ9Ik0xLjAxNCwxLjAzMUwxLjAxNCwzLjUzNiIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjEuNXB4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgxLjI1MDE5LDAsMCwxLC0wLjI1NDc3NSwwKSI+CiAgICAgICAgPHBhdGggZD0iTTEuMDE4LDEuMDI3TDMuMDE4LDEuMDI3IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS4zM3B4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8L2c+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCg2LjEyMzIzZS0xNywxLC0xLDYuMTIzMjNlLTE3LDE2LjAyNzQsMC4wMTMwNzE4KSI+CiAgICAgICAgPHBhdGggZD0iTTEuMDE0LDEuMDMxTDEuMDE0LDMuNTM2IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS41cHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDcuNjU1MjFlLTE3LDEuMjUwMTksLTEsNi4xMjMyM2UtMTcsMTYuMDI3NCwtMC4yNDE3MDQpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTgsMS4wMjdMMy4wMTgsMS4wMjciIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjMzcHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KC0xLC0xLjIyNDY1ZS0xNiwxLjIyNDY1ZS0xNiwtMSwxNiwxNi4wMjc0KSI+CiAgICAgICAgPHBhdGggZD0iTTEuMDE0LDEuMDMxTDEuMDE0LDMuNTM2IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS41cHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KC0xLjI1MDE5LC0xLjUzMTA0ZS0xNiwxLjIyNDY1ZS0xNiwtMSwxNi4yNTQ4LDE2LjAyNzQpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTgsMS4wMjdMMy4wMTgsMS4wMjciIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjMzcHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDYuMTIzMjNlLTE3LC0xLDEsNi4xMjMyM2UtMTcsLTAuMDI3MzU2LDE2LjAxNDMpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTQsMS4wMzFMMS4wMTQsMy41MzYiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjVweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoNy42NTUyMWUtMTcsLTEuMjUwMTksMSw2LjEyMzIzZS0xNywtMC4wMjczNTYsMTYuMjY5MSkiPgogICAgICAgIDxwYXRoIGQ9Ik0xLjAxOCwxLjAyN0wzLjAxOCwxLjAyNyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjEuMzNweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTMsOEw0LDciIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDxwYXRoIGQ9Ik0zLDhMNCw5IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8cGF0aCBkPSJNOCwxM0w3LDEyIiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8cGF0aCBkPSJNOCwxM0w5LDEyIiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8cGF0aCBkPSJNOCwzTDksNCIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPHBhdGggZD0iTTEzLDhMMTIsNyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgo8L3N2Zz4K"alt="Fit to Screen"class="floating-btn-icon"width="16"height="16"></button></div></div></div><div class="modal no-context-menu"id="attributeModal"style="display:none"><div class="modal-content"><div class="modal-header"><h3>Edit Shaper Attributes</h3><button class="modal-close"id="modalClose">&times;</button></div><div class="modal-body"><div class="path-info"><strong>Selected Path:</strong> <span id="selectedPathInfo"></span></div><form id="attributeForm"><div class="form-group"><label for="cutType">Cut Type:</label><div class="cut-type-slider"><div class="cut-type-options"><div class="cut-type-option"data-type="">none</div><div class="cut-type-option"data-type="online">Online</div><div class="cut-type-option"data-type="inside">Inside</div><div class="cut-type-option"data-type="outside">Outside</div><div class="cut-type-option"data-type="pocket">Pocket</div><div class="cut-type-option"data-type="guide">Guide</div></div><div class="cut-type-indicator"></div></div><input type="hidden"id="cutType"name="cutType"value=""></div><div class="form-group"><label for="cutDepth">Cut Depth:</label><div class="input-with-unit"><input id="cutDepth"name="cutDepth"placeholder="15"class="border-light rounded-sm"> <span class="input-unit">mm</span></div></div><div class="form-group"><label for="cutOffset">Cut Offset:</label><div class="input-with-unit"><input id="cutOffset"name="cutOffset"placeholder="0"class="border-light rounded-sm"> <span class="input-unit">mm</span></div></div><div class="form-group"><label for="toolDia">Tool Diameter:</label><div class="input-with-unit"><input id="toolDia"name="toolDia"placeholder="6"class="border-light rounded-sm"> <span class="input-unit">mm</span></div></div></form></div><div class="modal-footer"><button type="button"id="modalCancel"class="btn btn-secondary rounded transition-base border-light">Cancel</button> <button type="button"id="modalSave"class="btn btn-primary rounded transition-base">Save Changes</button></div></div></div></div><script>class ShaperConstants{static NAMESPACE="http://www.shapertools.com/namespaces/shaper";static NAMESPACE_PREFIX="shaper";static MEASUREMENT_ATTRIBUTES=["cutDepth","cutOffset","toolDia"];static SIMPLE_ATTRIBUTES=["cutType"];static ALL_ATTRIBUTES=[...this.MEASUREMENT_ATTRIBUTES,...this.SIMPLE_ATTRIBUTES];static getNamespacedAttributeName(t){return`${this.NAMESPACE_PREFIX}:${t}`}static getRawAttributeName(t){return`${this.NAMESPACE_PREFIX}-${t}-raw`}static EMPTY_VALUES=["","0","0.0","0,0"];static isEmptyValue(t){return this.EMPTY_VALUES.includes(t?.trim?.()||"")}static CSS_CLASSES={SELECTED:"path-selected",HOVER:"hover-active",OVERLAY:"path-overlay",BOUNDARY_OUTLINE:"svg-boundary-outline",NO_EXPORT:"no-export"};static ELEMENT_SELECTORS="path, rect, circle, ellipse, line, polygon, polyline"}class ShaperUtils{static syncAttribute(t,e,i){const s=t.getAttribute(i);null!==s?e.setAttribute(i,s):e.removeAttribute(i)}static syncAllShaperAttributes(t,e){ShaperConstants.ALL_ATTRIBUTES.forEach(i=>{const s=ShaperConstants.getRawAttributeName(i);this.syncAttribute(t,e,s)})}static setRawAttribute(t,e,i){const s=ShaperConstants.getRawAttributeName(e);null!=i&&i>0?t.setAttribute(s,i.toString()):t.removeAttribute(s)}static getRawAttributeValue(t,e){const i=ShaperConstants.getRawAttributeName(e),s=t.getAttribute(i);return s?parseFloat(s):null}static setNamespacedAttribute(t,e,i){if(i&&""!==i.trim()){const s=new SVGHelper,n=s.getSVGRoot(t);s.ensureShaperNamespace(n),t.setAttributeNS(ShaperConstants.NAMESPACE,ShaperConstants.getNamespacedAttributeName(e),i)}else t.removeAttributeNS(ShaperConstants.NAMESPACE,e)}static removeAllRawAttributes(t){ShaperConstants.ALL_ATTRIBUTES.forEach(e=>{t.removeAttribute(ShaperConstants.getRawAttributeName(e))})}static removeTempClasses(t){t.classList.remove(ShaperConstants.CSS_CLASSES.SELECTED,ShaperConstants.CSS_CLASSES.HOVER)}static findCorrespondingElement(t,e){if(console.log("findCorrespondingElement called"),!e||!t)return console.log("Missing targetSVG or sourceElement"),null;if(t.classList.contains(ShaperConstants.CSS_CLASSES.OVERLAY)||t.classList.contains(ShaperConstants.CSS_CLASSES.BOUNDARY_OUTLINE))return console.log("Source element is overlay/boundary, skipping"),null;const i=t.parentNode,s=Array.from(i.children).filter(t=>!t.classList.contains(ShaperConstants.CSS_CLASSES.OVERLAY)&&!t.classList.contains(ShaperConstants.CSS_CLASSES.BOUNDARY_OUTLINE)&&!t.classList.contains("boundary-overlay")),n=Array.from(e.children);console.log("Source elements (filtered):",s.length),console.log("Target elements:",n.length);const a=s.indexOf(t);if(console.log("Element index:",a),-1===a||a>=n.length)return console.log("Index not found or out of bounds"),null;const o=n[a];return console.log("Found corresponding element:",o),o&&o.tagName===t.tagName?o:null}static validateAttributeValue(t,e){const i=[],s=parseFloat(t);if(t&&isNaN(s))return i.push(`${e} must be a valid number`),i;switch(e){case"cutDepth":s<0&&i.push("Cut depth cannot be negative");break;case"toolDia":s<=0&&t&&i.push("Tool diameter must be positive")}return i}static validateAllAttributes(t){const e=[];return ShaperConstants.MEASUREMENT_ATTRIBUTES.forEach(i=>{if(t[i]){const s=this.validateAttributeValue(t[i],i);e.push(...s)}}),e}static createBoundaryOutline(t){return(new SVGHelper).createBoundaryOutline(t)}}window.ShaperConstants=ShaperConstants,window.ShaperUtils=ShaperUtils;class MeasurementSystem{constructor(){this._units="mm",this.decimalSeparator=this.detectLocalDecimalSeparator(),this.detectedUnits=null,this.dpi=96,this.mmPerInch=25.4,this.lastMeasurementCloneHTML=null}get units(){return this._units}set units(t){this._units=t}detectLocalDecimalSeparator(){return 1.1.toLocaleString().includes(",")?",":"."}getDecimalSeparator(){return this.decimalSeparator}setDecimalSeparator(t){this.decimalSeparator=t}formatDisplayNumber(t){const e=parseFloat(t).toFixed(3);let i=parseFloat(e).toString();i.includes(".")||(i+=".0");const s=this.getDecimalSeparator();return i.replace(".",s)}formatAngle(t){let e=t%360;e<0&&(e+=360);const i=e.toFixed(1),s=this.getDecimalSeparator();return i.replace(".",s)}formatWithUnits(t,e=3){const i=parseFloat(t).toFixed(e);return`${parseFloat(i).toString()}${this.units}`}setUnits(t){this._units=t}getUnits(){return this.units}stripUnitsFromValue(t){return parseFloat(t.toString().replace(/[a-zA-Z]/g,""))}addUnitsToValue(t){return`${t}${this.units}`}parseValueWithUnits(t,e=null){if(!t)return null;const i=t.toString().trim();if(!i)return null;let s=i;if(i.includes(",")&&!i.includes("."))s=i.replace(",",".");else if(i.includes(".")&&i.includes(",")){s=i.lastIndexOf(",")>i.lastIndexOf(".")?i.replace(/\./g,"").replace(",","."):i.replace(/,/g,"")}const n=s.match(/^([+-]?\d*\.?\d+)\s*([a-zA-Z]*)$/);if(!n)return null;const[,a,o]=n,r=parseFloat(a);return isNaN(r)?null:e&&o&&o!==e?this.convertBetweenUnits(r,o,e):e||!o||o===this.units||"mm"!==o&&"in"!==o?r:this.convertBetweenUnits(r,o,this.units)}convertValueToCurrentUnit(t){if(!t||""===t)return"";const e=this.parseValueWithUnits(t,this.units);if(null!==e)return this.formatDisplayNumber(e);const i=this.stripUnitsFromValue(t);return isNaN(i)?"":this.formatDisplayNumber(i)}convertBetweenUnits(t,e,i){if(e===i)return t;let s;switch(e){case"mm":s=t*this.dpi/this.mmPerInch;break;case"in":s=t*this.dpi;break;case"px":s=t;break;default:return t}switch(i){case"mm":return s*this.mmPerInch/this.dpi;case"in":return s/this.dpi;case"px":return s;default:return t}}convertPixelsToCurrentUnit(t){return this.convertBetweenUnits(t,"px",this.units)}unitsToPixels(t){return this.convertBetweenUnits(t,this.units,"px")}detectUnits(t){const e={mm:0,in:0,px:0};if(t){const i=t.getAttribute("viewBox"),s=t.getAttribute("width"),n=t.getAttribute("height");this.countUnitInString(i,e),this.countUnitInString(s,e),this.countUnitInString(n,e);t.querySelectorAll("*").forEach(t=>{["x","y","width","height","cx","cy","r","rx","ry","stroke-width"].forEach(i=>{const s=t.getAttribute(i);s&&this.countUnitInString(s,e)})})}const i=Math.max(...Object.values(e));return this.detectedUnits=0===i?"mm":Object.keys(e).find(t=>e[t]===i),this.detectedUnits=this.detectedUnits||"mm",this.detectedUnits}countUnitInString(t,e){if(!t)return;const i=t.match(/\bmm\b/g),s=t.match(/\bin\b/g),n=t.match(/\bpx\b/g);i&&(e.mm+=i.length),s&&(e.in+=s.length),n&&(e.px+=n.length)}getVisualDimensions(t,e){if(!t||!e||!t.dataset.appId)return{width:0,height:0};const i=t.dataset.appId,s=document.createElement("div");s.style.all="initial",s.style.position="absolute",s.style.left="-9999px",s.style.top="-9999px";try{const t=e.cloneNode(!0),n=t.getAttribute("viewBox");if(n){const[,,e,i]=n.split(/[ ,]+/);t.style.width=`${e}px`,t.style.height=`${i}px`}s.appendChild(t),document.body.appendChild(s);const a=t.querySelector(`[data-app-id="${i}"]`);if(a){const e=a.getBoundingClientRect();return this.lastMeasurementCloneHTML=t.outerHTML,{width:e.width,height:e.height}}return this.lastMeasurementCloneHTML=t.outerHTML,{width:0,height:0}}finally{s.firstChild&&(this.lastMeasurementCloneHTML=s.firstChild.outerHTML),s.parentNode&&s.parentNode.removeChild(s)}}analyzeSVG(t){const e=new Map;if(!t)return e;return t.querySelectorAll("[data-app-id]").forEach(i=>{const s=i.dataset.appId;if(!s)return;const n=this.getVisualDimensions(i,t),a=n.width,o=n.height,r=i.tagName.toLowerCase(),l={tagName:r,widthPx:a,heightPx:o};("circle"===r||"ellipse"===r&&Math.abs(a-o)<.1)&&(l.diameterPx=(a+o)/2,l.radiusPx=l.diameterPx/2,l.isCircle=!0);const h={};Array.from(i.attributes).forEach(t=>{if(t.name.startsWith("shaper:")){const e=t.value;if("shaper:cutType"===t.name)h[t.name]=e;else{const i=this.parseValueWithUnits(e);if(null!==i){const e=this.unitsToPixels(i);h[t.name]=e.toString()}else h[t.name]=e}}}),l.shaperAttributes=h,e.set(s,l)}),e}measureSVGBoundaryWithClone(t,e=null){if(e&&e.getCleanSVGClone){const t=e.getCleanSVGClone();if(t)return this._measureCleanSVG(t,"fileManager_cleanClone")}const i=this.detectRealSVGDimensions(t);if(i){this.lastMeasurementCloneHTML=`Real dimensions detected: ${i.width}${i.widthUnit} × ${i.height}${i.heightUnit}`;return{width:this.convertBetweenUnits(i.width,i.widthUnit,"px"),height:this.convertBetweenUnits(i.height,i.heightUnit,"px"),method:"realDimensions",originalWidth:`${i.width}${i.widthUnit}`,originalHeight:`${i.height}${i.heightUnit}`}}return this._measureCleanSVG(t,"manual_cleanup")}_measureCleanSVG(t,e){const i=document.createElement("div");i.style.all="initial",i.style.position="absolute",i.style.left="-9999px",i.style.top="-9999px";try{i.innerHTML=t.outerHTML,document.body.appendChild(i);const s=i.querySelector("svg");s.querySelectorAll(".no-export, .svg-boundary-outline, .boundary-overlay, .path-overlay").forEach(t=>t.remove());const n=s.getAttribute("viewBox");if(n){const[,,t,e]=n.split(/[ ,]+/).map(Number);s.style.width=`${t}px`,s.style.height=`${e}px`}const a=s.getBoundingClientRect();return this.lastMeasurementCloneHTML=s.outerHTML,{width:a.width,height:a.height,method:e,viewBox:n}}finally{i.parentNode&&i.parentNode.removeChild(i)}}detectRealSVGDimensions(t){const e=t.getAttribute("width"),i=t.getAttribute("height");if(!e||!i||e.includes("%")||i.includes("%"))return null;const s=e.match(/^([0-9.]+)\s*(mm|in|px|pt|pc|cm)?$/),n=i.match(/^([0-9.]+)\s*(mm|in|px|pt|pc|cm)?$/);if(s&&n){return{width:parseFloat(s[1]),height:parseFloat(n[1]),widthUnit:s[2]||"px",heightUnit:n[2]||"px"}}return null}}window.MeasurementSystem=MeasurementSystem;class ElementManager{constructor(t,e,i){this.measurementSystem=t,this.fileManager=e,this.elementDataMap=i,this.selectedPath=null,this.hoveredPath=null,this.svgHelper=new SVGHelper}selectPath(t){const e=document.querySelector(`.${ShaperConstants.CSS_CLASSES.SELECTED}`);e&&e.classList.remove(ShaperConstants.CSS_CLASSES.SELECTED),t?(t.classList.add(ShaperConstants.CSS_CLASSES.SELECTED),this.selectedPath=t):this.selectedPath=null}setHoveredPath(t){this.hoveredPath=t}getSelectedPath(){return this.selectedPath}getHoveredPath(){return this.hoveredPath}getElementDimensions(t){if(!t||!t.dataset.appId)return{};const e=t.dataset.appId;return this.elementDataMap.get(e)||{}}getElementDescription(t){const e=this.getElementDimensions(t);if(!e||!e.tagName)return"Unknown Element";const i=e.tagName;if(e.isCircle){const{diameterPx:t,radiusPx:i}=e,s=this.measurementSystem.convertPixelsToCurrentUnit(t),n=this.measurementSystem.convertPixelsToCurrentUnit(i);return`Circle: ⌀${this.measurementSystem.formatDisplayNumber(s)}${this.measurementSystem.units}; Radius: ${this.measurementSystem.formatDisplayNumber(n)}${this.measurementSystem.units}`}switch(i){case"rect":case"ellipse":case"polygon":case"polyline":case"path":{const{widthPx:t,heightPx:s}=e,n=this.measurementSystem.convertPixelsToCurrentUnit(t),a=this.measurementSystem.convertPixelsToCurrentUnit(s),o=i.charAt(0).toUpperCase()+i.slice(1);return n>0||a>0?`${o} - W: ${this.measurementSystem.formatDisplayNumber(n)}${this.measurementSystem.units}; H: ${this.measurementSystem.formatDisplayNumber(a)}${this.measurementSystem.units}`:`${o} (complex geometry)`}case"line":{const{width:t,height:i}=e,s=Math.sqrt(Math.pow(t,2)+Math.pow(i,2)),n=Math.atan2(i,t)*(180/Math.PI);return`Line - Length: ${this.measurementSystem.formatDisplayNumber(s)}${this.measurementSystem.units}; Angle: ${this.measurementSystem.formatAngle(n)}°`}default:return`${i.charAt(0).toUpperCase()+i.slice(1)} element`}}getElementMeasurements(t){const e=[],i=this.getElementDimensions(t);if(!i||!i.tagName)return e;const s=i.tagName;if(i.isCircle){const{diameterPx:t,radiusPx:s}=i,n=this.measurementSystem.convertPixelsToCurrentUnit(t),a=this.measurementSystem.convertPixelsToCurrentUnit(s);return e.push({name:"Diameter",value:`${this.measurementSystem.formatDisplayNumber(n)}${this.measurementSystem.units}`},{name:"Radius",value:`${this.measurementSystem.formatDisplayNumber(a)}${this.measurementSystem.units}`}),e}switch(s){case"rect":case"ellipse":case"polygon":case"polyline":case"path":{const{widthPx:t,heightPx:s}=i;if(t>0){const i=this.measurementSystem.convertPixelsToCurrentUnit(t);e.push({name:"Width",value:`${this.measurementSystem.formatDisplayNumber(i)}${this.measurementSystem.units}`})}if(s>0){const t=this.measurementSystem.convertPixelsToCurrentUnit(s);e.push({name:"Height",value:`${this.measurementSystem.formatDisplayNumber(t)}${this.measurementSystem.units}`})}break}case"line":{const{widthPx:t,heightPx:s}=i,n=Math.sqrt(Math.pow(t,2)+Math.pow(s,2)),a=this.measurementSystem.convertPixelsToCurrentUnit(n),o=Math.atan2(s,t)*(180/Math.PI);e.push({name:"Length",value:`${this.measurementSystem.formatDisplayNumber(a)}${this.measurementSystem.units}`},{name:"Angle",value:`${this.measurementSystem.formatAngle(o)}°`});break}}return e}extractPathCoordinates(t){const e=[];if(!t)return e;const i=t.match(/[-+]?\d*\.?\d+/g);if(i)for(let t=0;t<i.length;t+=2)t+1<i.length&&e.push({x:parseFloat(i[t]),y:parseFloat(i[t+1])});return e}createPathOverlay(t){const e=this.svgHelper.createOverlayElement(t,{fill:"transparent",stroke:"transparent","stroke-width":"10","pointer-events":"all",cursor:"pointer",class:`${ShaperConstants.CSS_CLASSES.OVERLAY} ${ShaperConstants.CSS_CLASSES.NO_EXPORT}`});return e.style.setProperty("pointer-events","all","important"),e}}window.ElementManager=ElementManager;class Viewport{constructor(){this.zoom=1,this.panX=0,this.panY=0,this.isDragging=!1,this.lastMouseX=0,this.lastMouseY=0,this.svgContainer=null,this.svgElement=null,this.onViewportChange=null,this.onViewportDragEnd=null,this.touchStartDistance=0,this.touchStartZoom=1,this.touchStartPanX=0,this.touchStartPanY=0,this.isTrackpadPanning=!1,this.svgHelper=new SVGHelper,this.anchorLogicalX=0,this.anchorLogicalY=0}setSVGElements(t,e){if(this.svgContainer=t,this.svgElement=e,this.svgElement){const t=this.svgElement.getAttribute("viewBox");if(t){const e=t.trim().split(/\s+/).map(Number);4===e.length&&e.every(t=>!isNaN(t))&&(this.anchorLogicalX=e[0],this.anchorLogicalY=e[1])}}}zoomIn(){this.zoom=Math.min(1.2*this.zoom,10),this.updateTransform(),this.updateZoomLevel(),this.notifyViewportChange(),this.onZoomChange&&this.onZoomChange()}zoomOut(){this.zoom=Math.max(this.zoom/1.2,.1),this.updateTransform(),this.updateZoomLevel(),this.notifyViewportChange(),this.onZoomChange&&this.onZoomChange()}zoomToFit(){const t=this.svgHelper.getDisplayedSVG();if(t&&this.svgContainer)try{const e=this.svgContainer.getBoundingClientRect(),i=this.svgHelper.getSafeBBox(t);if(!i)return;const s=.9*e.width/i.width,n=.9*e.height/i.height;this.zoom=Math.min(s,n,2),this.panX=0,this.panY=0,this.updateTransform(),this.updateZoomLevel(),this.notifyViewportChange(),this.onZoomChange&&this.onZoomChange()}catch(t){console.warn("Could not auto-fit SVG:",t)}}centerView(){this.panX=0,this.panY=0,this.updateTransform(),this.notifyViewportChange()}handleWheel(t){if(console.log("🎡 WHEEL EVENT:",{deltaX:t.deltaX,deltaY:t.deltaY,deltaZ:t.deltaZ,deltaMode:t.deltaMode,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,type:t.type,target:t.target.tagName}),t.preventDefault(),!this.svgContainer)return;let e=!1,i=1;if(t.ctrlKey&&Math.abs(t.deltaY)>0?(e=!0,i=Math.exp(.01*-t.deltaY),console.log("🤏 TRACKPAD PINCH ZOOM:",{deltaY:t.deltaY,zoomFactor:i})):t.altKey&&Math.abs(t.deltaY)>0?(e=!0,i=Math.exp(.01*-t.deltaY),console.log("�️ MOUSE WHEEL ZOOM:",{deltaY:t.deltaY,zoomFactor:i})):console.log("👆 TRACKPAD PAN:",{deltaX:t.deltaX,deltaY:t.deltaY}),e){const e=this.svgContainer.getBoundingClientRect(),s=t.clientX-e.left,n=t.clientY-e.top,a=this.zoom;this.zoom=Math.max(.1,Math.min(this.zoom*i,10));const o=this.zoom/a;this.panX=s-(s-this.panX)*o,this.panY=n-(n-this.panY)*o,this.updateTransform(),this.updateZoomLevel(),this.notifyViewportChange(),this.onZoomChange&&this.onZoomChange()}else{const e=1;this.panX-=t.deltaX*e,this.panY-=t.deltaY*e,this.updateTransform(),(Math.abs(t.deltaX)>5||Math.abs(t.deltaY)>5)&&this.notifyViewportDragEnd()}}handleMouseDown(t){console.log("🖱️ MOUSE DOWN:",{button:t.button,buttons:t.buttons,ctrlKey:t.ctrlKey,metaKey:t.metaKey,clientX:t.clientX,clientY:t.clientY});const e=1===t.button,i=t.ctrlKey&&0===t.button;(e||i)&&(console.log("✅ STARTING MOUSE DRAG"),t.preventDefault(),this.isDragging=!0,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY,this.svgContainer&&this.svgContainer.classList.add("dragging"))}handleTouchStart(t){if(console.log("👆 TOUCH START:",{touchCount:t.touches.length,touches:Array.from(t.touches).map(t=>({x:t.clientX,y:t.clientY}))}),2===t.touches.length){console.log("✅ STARTING TOUCH GESTURE"),t.preventDefault();const e=t.touches[0],i=t.touches[1],s=e.clientX-i.clientX,n=e.clientY-i.clientY;this.touchStartDistance=Math.sqrt(s*s+n*n),this.touchStartZoom=this.zoom,this.touchStartPanX=this.panX,this.touchStartPanY=this.panY,this.lastMouseX=(e.clientX+i.clientX)/2,this.lastMouseY=(e.clientY+i.clientY)/2,this.isTrackpadPanning=!0}}handleTouchMove(t){if(2===t.touches.length&&this.isTrackpadPanning){t.preventDefault();const e=t.touches[0],i=t.touches[1],s=e.clientX-i.clientX,n=e.clientY-i.clientY,a=Math.sqrt(s*s+n*n),o=(e.clientX+i.clientX)/2,r=(e.clientY+i.clientY)/2;if(Math.abs(a-this.touchStartDistance)>.5*Math.sqrt(Math.pow(o-this.lastMouseX,2)+Math.pow(r-this.lastMouseY,2))){const t=a/this.touchStartDistance;this.zoom=Math.max(.1,Math.min(this.touchStartZoom*t,10))}else{const t=o-this.lastMouseX,e=r-this.lastMouseY;this.panX=this.touchStartPanX+t,this.panY=this.touchStartPanY+e}this.updateTransform(),this.updateZoomLevel()}}handleTouchEnd(t){this.isTrackpadPanning&&(this.isTrackpadPanning=!1,this.notifyViewportChange(),this.onZoomChange&&this.onZoomChange())}handleMouseMove(t){if(!this.isDragging)return;const e=t.clientX-this.lastMouseX,i=t.clientY-this.lastMouseY;this.panX+=e,this.panY+=i,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY,this.updateTransform()}handleMouseUp(t){this.isDragging&&(this.isDragging=!1,this.svgContainer&&this.svgContainer.classList.remove("dragging"),this.notifyViewportDragEnd())}updateTransform(){const t=document.getElementById("svgContent");document.getElementById("gutterOverlay");if(!t)return;"0px 0px"!==t.style.transformOrigin&&(t.style.transformOrigin="0 0");const e=`translate(${this.panX}px, ${this.panY}px) scale(${this.zoom})`;t.style.transform=e,this.updateInfiniteGrid(),this.updateStrokeWidths()}updateInfiniteGrid(){const t=document.getElementById("gutterOverlay");if(!t||"none"===t.style.display)return;const e=parseFloat(t.dataset.baseCell||"0");if(!e||e<=0)return;const i=this.zoom,s=e*i;if(s<2)return;t.style.backgroundSize=`${s}px ${s}px`;const n=i*this.anchorLogicalX+this.panX,a=i*this.anchorLogicalY+this.panY,o=(n%s+s)%s,r=(a%s+s)%s;t.style.backgroundPosition=`${o}px ${r}px`;let l=t.querySelector(".gutter-intersection");l||(l=document.createElement("div"),l.className="gutter-intersection",Object.assign(l.style,{position:"absolute",width:"6px",height:"6px",background:"#1673ff",border:"none",pointerEvents:"none",zIndex:"10"}),t.appendChild(l));const h=l.offsetWidth||6;l.style.left=n-h/2+"px",l.style.top=a-h/2+"px",window.shaperEditor&&"function"==typeof window.shaperEditor.refreshGridDebugAnchors&&window.shaperEditor.refreshGridDebugAnchors(n,a)}updateStrokeWidths(){const t=1/this.zoom;document.querySelectorAll(".svg-boundary-outline").forEach(e=>{e.setAttribute("stroke-width",(2*t).toString())});document.querySelectorAll(".boundary-overlay").forEach(e=>{e.setAttribute("stroke-width",(10*t).toString())});document.querySelectorAll('path[stroke="transparent"]').forEach(e=>{e.setAttribute("stroke-width",(10*t).toString())})}updateZoomLevel(){const t=document.getElementById("zoomLevel");t&&(t.value=Math.round(100*this.zoom).toString())}validateAndApplyZoom(t){let e=t.replace(",","."),i=parseFloat(e);isNaN(i)?this.zoom=1:(i=Math.round(i),i=Math.max(10,Math.min(1e3,i)),this.zoom=i/100),this.updateTransform(),this.updateZoomLevel(),this.notifyViewportChange(),this.onZoomChange&&this.onZoomChange()}setupZoomInput(){const t=document.getElementById("zoomLevel");t&&(t.addEventListener("blur",t=>{this.validateAndApplyZoom(t.target.value)}),t.addEventListener("keydown",t=>{"Enter"===t.key&&t.target.blur()}))}resetViewport(){this.zoom=1,this.panX=0,this.panY=0,this.updateTransform(),this.updateZoomLevel()}zoomTo100(){this.zoom=1,this.updateTransform(),this.updateZoomLevel(),this.notifyViewportChange(),this.onZoomChange&&this.onZoomChange()}getZoom(){return this.zoom}getPan(){return{x:this.panX,y:this.panY}}setZoom(t){this.zoom=Math.max(.1,Math.min(t,10))}setPan(t,e){this.panX=t,this.panY=e}getLastMousePosition(){return{x:this.lastMouseX,y:this.lastMouseY}}updateMousePosition(t,e){this.lastMouseX=t,this.lastMouseY=e}notifyViewportChange(){this.onViewportChange&&this.onViewportChange()}notifyViewportDragEnd(){this.onViewportDragEnd&&this.onViewportDragEnd()}}window.Viewport=Viewport;class UIComponents{constructor(t,e){this.measurementSystem=t,this.elementManager=e,this.modal=null,this.tooltip=null,this.tooltipHideTimeout=null,this.cutTypeOptions=null,this.cutTypeIndicator=null,this.cutTypeInput=null,this.selectedPathInfo=null,this.contextMenu=null,this.contextMenuVisible=!1,this.optionWidth=0}initializeElements(){this.modal=document.getElementById("attributeModal"),this.selectedPathInfo=document.getElementById("selectedPathInfo"),this.createTooltip(),this.createContextMenu(),this.initializeCutTypeSlider()}openAttributeModal(t){this.elementManager.selectPath(t),this.populateAttributeForm(t),this.modal.style.display="flex"}closeModal(){this.modal.style.display="none",this.elementManager.selectPath(null),document.getElementById("cutDepth").value="",document.getElementById("cutOffset").value="",document.getElementById("toolDia").value=""}populateAttributeForm(t){this.selectedPathInfo&&(this.selectedPathInfo.textContent=this.elementManager.getElementDescription(t));const e=this.elementManager.getElementDimensions(t).shaperAttributes||{},i=e["shaper:cutType"]||"";["cutDepth","cutOffset","toolDia"].forEach(t=>{const i=document.getElementById(t),s=e[`shaper:${t}`];if(s&&""!==s.trim()){const t=parseFloat(s);if(isNaN(t))i.value="";else{const e=this.measurementSystem.convertPixelsToCurrentUnit(t),s=this.measurementSystem.formatDisplayNumber(e);i.value=s}}else i.value=""}),this.setCutTypeSlider(i),this.updateDialogUnits()}updateDialogUnits(){document.querySelectorAll(".input-unit").forEach(t=>{t.textContent=this.measurementSystem.units})}initializeCutTypeSlider(){this.cutTypeOptions=document.querySelectorAll(".cut-type-option"),this.cutTypeIndicator=document.querySelector(".cut-type-indicator"),this.cutTypeInput=document.getElementById("cutType"),this.optionWidth=100/this.cutTypeOptions.length,this.cutTypeOptions.forEach((t,e)=>{t.addEventListener("click",()=>this.selectCutType(e))})}selectCutType(t){this.cutTypeOptions.forEach(t=>t.classList.remove("active")),this.cutTypeOptions[t].classList.add("active"),this.updateCutTypeUI(t),this.cutTypeInput.value=this.cutTypeOptions[t].getAttribute("data-type")}setCutTypeSlider(t){const e=Array.from(this.cutTypeOptions).find(e=>e.getAttribute("data-type")===t);if(e){const t=Array.from(this.cutTypeOptions).indexOf(e);this.selectCutType(t)}}updateCutTypeUI(t){this.cutTypeIndicator&&(this.cutTypeIndicator.style.left=t*this.optionWidth+"%",this.cutTypeIndicator.style.width=`${this.optionWidth}%`)}createTooltip(){this.tooltip=document.createElement("div"),this.tooltip.className="shaper-tooltip",document.body.appendChild(this.tooltip)}showTooltip(t,e,i){if(!this.tooltip)return;this.tooltipHideTimeout&&(clearTimeout(this.tooltipHideTimeout),this.tooltipHideTimeout=null);let s=`<div class="tooltip-title">Element Info (${(t.dataset.appId||"unknown").replace("app-id-","")})</div>`;const n=this.elementManager.getElementMeasurements(t);n.length>0&&(s+='<div class="tooltip-section"><div class="section-title">Measurements</div>',n.forEach(t=>{s+=`\n                    <div class="tooltip-measurement">\n                        <span class="measurement-name">${t.name}:</span>\n                        <span class="measurement-value">${t.value}</span>\n                    </div>`}),s+="</div>"),s+='<div class="tooltip-section"><div class="section-title">Shaper Attributes</div>';const a=this.getShaperAttributes(t);0===a.length?s+='<div class="no-attributes">No shaper attributes defined<br>- click to change</div>':a.forEach(t=>{s+=`\n                    <div class="tooltip-attribute">\n                        <span class="attr-name">${t.name}:</span>\n                        <span class="attr-value">${t.value}</span>\n                    </div>`}),s+="</div>",this.tooltip.innerHTML=s,this.updateTooltipPosition(e,i),this.tooltip.style.display="block",setTimeout(()=>{this.tooltip&&this.tooltip.classList.add("visible")},10)}showBoundaryTooltip(t,e,i){if(!this.tooltip)return;const s=t.closest("svg"),n=this.editor?this.editor.fileManager:null,a=this.measurementSystem.measureSVGBoundaryWithClone(s,n),o=this.measurementSystem.convertPixelsToCurrentUnit(a.width),r=this.measurementSystem.convertPixelsToCurrentUnit(a.height);let l='<div class="tooltip-title">SVG Canvas Boundary</div>';l+='<div class="tooltip-section">',l+='<div class="section-title">Canvas Dimensions</div>',l+=`\n            <div class="tooltip-measurement">\n                <span class="measurement-name">Width:</span>\n                <span class="measurement-value">${this.measurementSystem.formatDisplayNumber(o)}${this.measurementSystem.units}</span>\n            </div>\n            <div class="tooltip-measurement">\n                <span class="measurement-name">Height:</span>\n                <span class="measurement-value">${this.measurementSystem.formatDisplayNumber(r)}${this.measurementSystem.units}</span>\n            </div>`,l+="</div>",this.tooltip.innerHTML=l,this.updateTooltipPosition(e,i),this.tooltip.style.display="block",setTimeout(()=>{this.tooltip&&this.tooltip.classList.add("visible")},10)}hideTooltip(){this.tooltip&&this.tooltip.classList.contains("visible")&&(this.tooltipHideTimeout&&clearTimeout(this.tooltipHideTimeout),this.tooltipHideTimeout=setTimeout(()=>{this.tooltip&&this.tooltip.classList.contains("visible")&&(this.tooltip.classList.remove("visible"),setTimeout(()=>{this.tooltip&&!this.tooltip.classList.contains("visible")&&(this.tooltip.style.display="none")},300)),this.tooltipHideTimeout=null},50))}updateTooltipPosition(t,e){if(!this.tooltip)return;const i="none"===this.tooltip.style.display;i&&(this.tooltip.style.visibility="hidden",this.tooltip.style.display="block");const s=this.tooltip.getBoundingClientRect(),n=s.width,a=s.height;i&&(this.tooltip.style.display="none",this.tooltip.style.visibility="visible");let o=t+10,r=e-10;o+n>window.innerWidth&&(o=t-n-10),r+a>window.innerHeight&&(r=e-a-10),o<0&&(o=5),r<0&&(r=5),this.tooltip.style.left=`${o}px`,this.tooltip.style.top=`${r}px`}refreshTooltip(){const t=this.elementManager.getHoveredPath();t&&this.tooltip&&"none"!==this.tooltip.style.display&&(this.hideTooltip(),setTimeout(()=>{const e={x:this.lastMouseX||0,y:this.lastMouseY||0};this.showTooltip(t,e.x,e.y)},10))}refreshTooltipIfVisible(){if(this.tooltip&&"none"!==this.tooltip.style.display&&this.tooltip.classList.contains("visible")){const t=this.elementManager.getHoveredPath()||this.elementManager.getSelectedPath();if(t){const e={x:this.lastMouseX||0,y:this.lastMouseY||0};this.showTooltip(t,e.x,e.y)}}}getShaperAttributes(t){const e=[],i=this.elementManager.getElementDimensions(t).shaperAttributes||{},s=["shaper:cutDepth","shaper:cutOffset","shaper:toolDia"].some(t=>i[t]&&""!==i[t].trim()),n=i["shaper:cutType"]&&""!==i["shaper:cutType"].trim();if(!s&&!n)return e;return["shaper:cutType","shaper:cutDepth","shaper:cutOffset","shaper:toolDia"].forEach(t=>{const s=i[t];let n,a;if(a=t.replace("shaper:",""),a=a.charAt(0).toUpperCase()+a.slice(1),s&&""!==s.trim())if("shaper:cutType"===t)n=s;else{const t=parseFloat(s);if(isNaN(t))n=s;else{const e=this.measurementSystem.convertPixelsToCurrentUnit(t);n=`${this.measurementSystem.formatDisplayNumber(e)}${this.measurementSystem.units}`}}else n="not set";e.push({name:a,value:n})}),e}handleKeyDown(t){"Escape"===t.key&&this.modal&&"none"!==this.modal.style.display&&this.closeModal(),"Enter"===t.key&&this.modal&&"none"!==this.modal.style.display&&"INPUT"!==t.target.tagName&&this.saveAttributes()}saveAttributes(){}setMousePosition(t,e){this.lastMouseX=t,this.lastMouseY=e}createContextMenu(){this.contextMenuBackdrop=document.createElement("div"),this.contextMenuBackdrop.className="context-menu-backdrop",this.contextMenu=document.createElement("div"),this.contextMenu.id="customContextMenu",this.contextMenu.className="custom-context-menu";[{label:"Export SVG",action:"export",icon:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTciIHZpZXdCb3g9IjAgMCAxNCAxNyIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICBjbGFzcz0iZmxvYXRpbmctYnRuLWljb24gZXhwb3J0LWljb24iPgogICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTEwIDZIMTRMNyAxM0wwIDZINFYwSDEwVjZaTTAgMTdWMTVIMTRWMTdIMFoiIGZpbGw9IiMwMDAiPjwvcGF0aD4KPC9zdmc+"},{label:"Copy to Clipboard",action:"copy",icon:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxwYXRoCiAgICAgICAgZD0iTTEwLjUgMkgxMkMxMi41NTIzIDIgMTMgMi40NDc3MiAxMyAzVjEzQzEzIDEzLjU1MjMgMTIuNTUyMyAxNCAxMiAxNEg0QzMuNDQ3NzIgMTQgMyAxMy41NTIzIDMgMTNWM0MzIDIuNDQ3NzIgMy40NDc3MiAyIDQgMkg1LjUiCiAgICAgICAgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMS4yIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIC8+CiAgICA8cGF0aAogICAgICAgIGQ9Ik02IDFIMTBDMTAuMjc2MSAxIDEwLjUgMS4yMjM4NiAxMC41IDEuNVYyLjVDMTAuNSAyLjc3NjE0IDEwLjI3NjEgMyAxMCAzSDZDNS43MjM4NiAzIDUuNSAyLjc3NjE0IDUuNSAyLjVWMS41QzUuNSAxLjIyMzg2IDUuNzIzODYgMSA2IDFaIgogICAgICAgIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiAvPgogICAgPHBhdGggZD0iTTYgNkgxMCIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMS4yIiBzdHJva2UtbGluZWNhcD0icm91bmQiIC8+CiAgICA8cGF0aCBkPSJNNiA4SDEwIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgLz4KICAgIDxwYXRoIGQ9Ik02IDEwSDgiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiAvPgo8L3N2Zz4="},{separator:!0},{label:"Zoom to Fit",action:"zoomFit",icon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDE2IDE2IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zOnNlcmlmPSJodHRwOi8vd3d3LnNlcmlmLmNvbS8iIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtzdHJva2UtbGluZWNhcDpyb3VuZDsiPgogICAgPHBhdGggZD0iTTgsM0w4LDZNOCwxMEw4LDEzTTMsOEw2LDhNMTAsOEwxMyw4IiBzdHlsZT0iZmlsbDpub25lO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MXB4OyIvPgogICAgPHBhdGggZD0iTTgsM0w3LDQiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDxwYXRoIGQ9Ik0xMyw4TDEyLDkiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDxwYXRoIGQ9Ik0xLjAxNCwxLjAzMUwxLjAxNCwzLjUzNiIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjEuNXB4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgxLjI1MDE5LDAsMCwxLC0wLjI1NDc3NSwwKSI+CiAgICAgICAgPHBhdGggZD0iTTEuMDE4LDEuMDI3TDMuMDE4LDEuMDI3IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS4zM3B4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8L2c+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCg2LjEyMzIzZS0xNywxLC0xLDYuMTIzMjNlLTE3LDE2LjAyNzQsMC4wMTMwNzE4KSI+CiAgICAgICAgPHBhdGggZD0iTTEuMDE0LDEuMDMxTDEuMDE0LDMuNTM2IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS41cHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDcuNjU1MjFlLTE3LDEuMjUwMTksLTEsNi4xMjMyM2UtMTcsMTYuMDI3NCwtMC4yNDE3MDQpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTgsMS4wMjdMMy4wMTgsMS4wMjciIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjMzcHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KC0xLC0xLjIyNDY1ZS0xNiwxLjIyNDY1ZS0xNiwtMSwxNiwxNi4wMjc0KSI+CiAgICAgICAgPHBhdGggZD0iTTEuMDE0LDEuMDMxTDEuMDE0LDMuNTM2IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS41cHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KC0xLjI1MDE5LC0xLjUzMTA0ZS0xNiwxLjIyNDY1ZS0xNiwtMSwxNi4yNTQ4LDE2LjAyNzQpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTgsMS4wMjdMMy4wMTgsMS4wMjciIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjMzcHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDYuMTIzMjNlLTE3LC0xLDEsNi4xMjMyM2UtMTcsLTAuMDI3MzU2LDE2LjAxNDMpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTQsMS4wMzFMMS4wMTQsMy41MzYiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjVweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoNy42NTUyMWUtMTcsLTEuMjUwMTksMSw2LjEyMzIzZS0xNywtMC4wMjczNTYsMTYuMjY5MSkiPgogICAgICAgIDxwYXRoIGQ9Ik0xLjAxOCwxLjAyN0wzLjAxOCwxLjAyNyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjEuMzNweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPHBhdGggZD0iTTMsOEw0LDciIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDxwYXRoIGQ9Ik0zLDhMNCw5IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8cGF0aCBkPSJNOCwxM0w3LDEyIiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8cGF0aCBkPSJNOCwxM0w5LDEyIiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8cGF0aCBkPSJNOCwzTDksNCIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPHBhdGggZD0iTTEzLDhMMTIsNyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgo8L3N2Zz4K"},{label:"Center View",action:"center",icon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDE2IDE2IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zOnNlcmlmPSJodHRwOi8vd3d3LnNlcmlmLmNvbS8iIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtzdHJva2UtbGluZWNhcDpyb3VuZDsiPgogICAgPHBhdGggZD0iTTgsMUw4LDRNOCwxMkw4LDE1TTEsOEw0LDhNMTIsOEwxNSw4IiBzdHlsZT0iZmlsbDpub25lO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MXB4OyIvPgogICAgPHBhdGggZD0iTTEuMDE0LDEuMDMxTDEuMDE0LDMuNTM2IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS41cHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsNi45ODU3Miw1LjcxNjcxKSI+CiAgICAgICAgPHBhdGggZD0iTTEuMDE0LDEuMDMxTDEuMDE0LDMuNTM2IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS41cHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDEuMjUwMTksMCwwLDEsLTAuMjU0Nzc1LDApIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTgsMS4wMjdMMy4wMTgsMS4wMjciIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjMzcHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDYuMTIzMjNlLTE3LDEsLTEsNi4xMjMyM2UtMTcsMTYuMDI3NCwwLjAxMzA3MTgpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTQsMS4wMzFMMS4wMTQsMy41MzYiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjVweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoNi4xMjMyM2UtMTcsMSwtMSw2LjEyMzIzZS0xNywxMC4yODMzLDYuOTg1NzIpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTQsMS4wMzFMMS4wMTQsMy41MzYiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjVweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoNy42NTUyMWUtMTcsMS4yNTAxOSwtMSw2LjEyMzIzZS0xNywxNi4wMjc0LC0wLjI0MTcwNCkiPgogICAgICAgIDxwYXRoIGQ9Ik0xLjAxOCwxLjAyN0wzLjAxOCwxLjAyNyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjEuMzNweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoLTEsLTEuMjI0NjVlLTE2LDEuMjI0NjVlLTE2LC0xLDE2LDE2LjAyNzQpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTQsMS4wMzFMMS4wMTQsMy41MzYiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjVweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoLTEuMjUwMTksLTEuNTMxMDRlLTE2LDEuMjI0NjVlLTE2LC0xLDE2LjI1NDgsMTYuMDI3NCkiPgogICAgICAgIDxwYXRoIGQ9Ik0xLjAxOCwxLjAyN0wzLjAxOCwxLjAyNyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjEuMzNweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoNi4xMjMyM2UtMTcsLTEsMSw2LjEyMzIzZS0xNywtMC4wMjczNTYsMTYuMDE0MykiPgogICAgICAgIDxwYXRoIGQ9Ik0xLjAxNCwxLjAzMUwxLjAxNCwzLjUzNiIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjEuNXB4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8L2c+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCg3LjY1NTIxZS0xNywtMS4yNTAxOSwxLDYuMTIzMjNlLTE3LC0wLjAyNzM1NiwxNi4yNjkxKSI+CiAgICAgICAgPHBhdGggZD0iTTEuMDE4LDEuMDI3TDMuMDE4LDEuMDI3IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS4zM3B4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8L2c+Cjwvc3ZnPgo="},{label:"Zoom 100%",action:"zoom100",icon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDE2IDE2IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zOnNlcmlmPSJodHRwOi8vd3d3LnNlcmlmLmNvbS8iIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtzdHJva2UtbGluZWNhcDpyb3VuZDsiPgogICAgPHBhdGggZD0iTTgsMUw4LDRNOCwxMkw4LDE1TTEsOEw0LDhNMTIsOEwxNSw4IiBzdHlsZT0iZmlsbDpub25lO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MXB4OyIvPgogICAgPHBhdGggZD0iTTEuMDE0LDEuMDMxTDEuMDE0LDMuNTM2IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS41cHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsNi45ODU3Miw1LjcxNjcxKSI+CiAgICAgICAgPHBhdGggZD0iTTEuMDE0LDEuMDMxTDEuMDE0LDMuNTM2IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS41cHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDEuMjUwMTksMCwwLDEsLTAuMjU0Nzc1LDApIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTgsMS4wMjdMMy4wMTgsMS4wMjciIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjMzcHg7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNTsiLz4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDYuMTIzMjNlLTE3LDEsLTEsNi4xMjMyM2UtMTcsMTYuMDI3NCwwLjAxMzA3MTgpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTQsMS4wMzFMMS4wMTQsMy41MzYiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjVweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoNi4xMjMyM2UtMTcsMSwtMSw2LjEyMzIzZS0xNywxMC4yODMzLDYuOTg1NzIpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTQsMS4wMzFMMS4wMTQsMy41MzYiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjVweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoNy42NTUyMWUtMTcsMS4yNTAxOSwtMSw2LjEyMzIzZS0xNywxNi4wMjc0LC0wLjI0MTcwNCkiPgogICAgICAgIDxwYXRoIGQ9Ik0xLjAxOCwxLjAyN0wzLjAxOCwxLjAyNyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjEuMzNweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoLTEsLTEuMjI0NjVlLTE2LDEuMjI0NjVlLTE2LC0xLDE2LDE2LjAyNzQpIj4KICAgICAgICA8cGF0aCBkPSJNMS4wMTQsMS4wMzFMMS4wMTQsMy41MzYiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDoxLjVweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoLTEuMjUwMTksLTEuNTMxMDRlLTE2LDEuMjI0NjVlLTE2LC0xLDE2LjI1NDgsMTYuMDI3NCkiPgogICAgICAgIDxwYXRoIGQ9Ik0xLjAxOCwxLjAyN0wzLjAxOCwxLjAyNyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjEuMzNweDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS41OyIvPgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoNi4xMjMyM2UtMTcsLTEsMSw2LjEyMzIzZS0xNywtMC4wMjczNTYsMTYuMDE0MykiPgogICAgICAgIDxwYXRoIGQ9Ik0xLjAxNCwxLjAzMUwxLjAxNCwzLjUzNiIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6YmxhY2s7c3Ryb2tlLXdpZHRoOjEuNXB4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8L2c+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCg3LjY1NTIxZS0xNywtMS4yNTAxOSwxLDYuMTIzMjNlLTE3LC0wLjAyNzM1NiwxNi4yNjkxKSI+CiAgICAgICAgPHBhdGggZD0iTTEuMDE4LDEuMDI3TDMuMDE4LDEuMDI3IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MS4zM3B4O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjU7Ii8+CiAgICA8L2c+Cjwvc3ZnPgo="}].forEach(t=>{if(t.separator){const t=document.createElement("div");t.className="context-menu-separator",this.contextMenu.appendChild(t)}else{const e=document.createElement("button");e.className="context-menu-item",e.dataset.action=t.action;const i=document.createElement("img");i.className="context-menu-icon",i.src=t.icon;const s=document.createElement("span");s.textContent=t.label,e.appendChild(i),e.appendChild(s),e.addEventListener("click",e=>{e.stopPropagation(),this.handleContextMenuAction(t.action),this.hideContextMenu()}),this.contextMenu.appendChild(e)}}),document.body.appendChild(this.contextMenuBackdrop),document.body.appendChild(this.contextMenu),this.setupContextMenuEvents()}setupContextMenuEvents(){document.addEventListener("contextmenu",t=>{t.preventDefault();let e=t.target;for(;e;){if(e.classList&&e.classList.contains("no-context-menu"))return;e=e.parentElement}const i=document.getElementById("svgContainer"),s=document.getElementById("editorSection");(i&&i.contains(t.target)||s&&s.contains(t.target))&&this.showContextMenu(t.clientX,t.clientY)}),document.addEventListener("click",()=>{this.hideContextMenu()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.hideContextMenu()})}showContextMenu(t,e){if(!this.contextMenu||!this.contextMenuBackdrop)return;this.contextMenuBackdrop.style.display="block",this.contextMenu.style.left=`${t}px`,this.contextMenu.style.top=`${e}px`,this.contextMenu.style.display="block",this.contextMenuVisible=!0;const i=this.contextMenu.getBoundingClientRect(),s=window.innerWidth,n=window.innerHeight;i.right>s&&(this.contextMenu.style.left=s-i.width-10+"px"),i.bottom>n&&(this.contextMenu.style.top=n-i.height-10+"px")}hideContextMenu(){this.contextMenu&&this.contextMenuBackdrop&&(this.contextMenu.style.display="none",this.contextMenuBackdrop.style.display="none",this.contextMenuVisible=!1)}handleContextMenuAction(t){switch(t){case"export":this.onExportSVG&&this.onExportSVG();break;case"copy":this.onCopyToClipboard&&this.onCopyToClipboard();break;case"zoomFit":this.onZoomToFit&&this.onZoomToFit();break;case"center":this.onCenterView&&this.onCenterView();break;case"zoom100":this.onZoom100&&this.onZoom100()}}}window.UIComponents=UIComponents;class SVGHelper{constructor(){}createCleanSVGCopy(t,e=!0,i=null){if(!t)return console.warn("SVGHelper.createCleanSVGCopy: No SVG element provided"),null;const s=t.cloneNode(!0);return e&&this.removeViewportAttributes(s),this.removeOverlayElements(s),this.removeBoundaryElements(s),this.cleanupTemporaryAttributes(s,i),s}removeViewportAttributes(t){t.style&&(t.style.transform="",t.style.cssText&&""!==t.style.cssText.trim()||t.removeAttribute("style"));["data-zoom","data-pan-x","data-pan-y"].forEach(e=>{t.hasAttribute(e)&&t.removeAttribute(e)})}removeOverlayElements(t){t.querySelectorAll(`.${ShaperConstants.CSS_CLASSES.NO_EXPORT}`).forEach(t=>t.remove())}removeBoundaryElements(t){[`.${ShaperConstants.CSS_CLASSES.BOUNDARY_OUTLINE}`,".boundary-outline",".boundary-element",".boundary-highlight",".svg-boundary-outline"].forEach(e=>{t.querySelectorAll(e).forEach(t=>t.remove())})}cleanupTemporaryAttributes(t,e=null){t.querySelectorAll(ShaperConstants.ELEMENT_SELECTORS).forEach(t=>{this.removeTemporaryClasses(t),e&&"function"==typeof e.prepareElementForExport?e.prepareElementForExport(t):(ShaperUtils.removeTempClasses(t),ShaperUtils.removeAllRawAttributes(t))}),this.ensureShaperNamespace(t)}removeTemporaryClasses(t){t.classList.remove(ShaperConstants.CSS_CLASSES.NO_EXPORT)}serializeSVG(t,e=!0){if(!t)return console.warn("SVGHelper.serializeSVG: No SVG element provided"),"";let i=t;if(e&&(i=this.createCleanSVGCopy(t),!i))return"";return(new XMLSerializer).serializeToString(i)}getDisplayedSVG(){return document.querySelector("#svgContent svg")}createCleanDisplayedSVGCopy(t=!0){const e=this.getDisplayedSVG();return this.createCleanSVGCopy(e,t)}getCleanDisplayedSVGString(t=null){const e=this.getDisplayedSVG();if(!e)return"";const i=this.createCleanSVGCopy(e,!0,t);return this.serializeSVG(i,!1)}validateSVGStructure(t){if(!t)return!1;if("svg"!==t.tagName.toLowerCase())return!1;return"http://www.w3.org/2000/svg"===t.namespaceURI}ensureShaperNamespace(t){t&&!t.hasAttribute(`xmlns:${ShaperConstants.NAMESPACE_PREFIX}`)&&t.setAttribute(`xmlns:${ShaperConstants.NAMESPACE_PREFIX}`,ShaperConstants.NAMESPACE)}createSVGElement(t,e={}){const i=document.createElementNS("http://www.w3.org/2000/svg",t);return Object.entries(e).forEach(([t,e])=>{i.setAttribute(t,e)}),i}getSVGRoot(t=null,e="svgContent"){if(t)return t.ownerDocument.querySelector("svg");const i=document.getElementById(e);return i?i.querySelector("svg"):null}cloneSVGElement(t,e=null,i=!0){if(!t)return console.warn("SVGHelper.cloneSVGElement: No SVG element provided"),null;const s=t.cloneNode(i);return e&&e.appendChild(s),s}createPath(t,e={}){return this.createSVGElement("path",{d:t,...e})}createOverlayElement(t,e={}){if(!t)return console.warn("SVGHelper.createOverlayElement: No original element provided"),null;const i=this.createSVGElement(t.tagName);return["d","points","x","y","x1","y1","x2","y2","cx","cy","r","rx","ry","width","height"].forEach(e=>{t.hasAttribute(e)&&i.setAttribute(e,t.getAttribute(e))}),Object.entries(e).forEach(([t,e])=>{i.setAttribute(t,e)}),i}getSafeBBox(t){try{return t.getBBox()}catch(t){return console.warn("SVGHelper.getSafeBBox: Could not get bounding box",t),null}}createBoundaryOutline(t,e={}){let i=0,s=0,n=400,a=300;const o=t.getAttribute("viewBox");o?[i,s,n,a]=o.split(" ").map(Number):(n=parseFloat(t.getAttribute("width"))||400,a=parseFloat(t.getAttribute("height"))||300);const r={d:`M ${i} ${s} L ${i+n} ${s} L ${i+n} ${s+a} L ${i} ${s+a} Z`,class:`${ShaperConstants.CSS_CLASSES.BOUNDARY_OUTLINE} ${ShaperConstants.CSS_CLASSES.NO_EXPORT}`};return this.createSVGElement("path",{...r,...e})}}window.SVGHelper=SVGHelper;class FileManager{constructor(t){this.measurementSystem=t,this.svg=null,this.svgElement=null,this.masterSVGElement=null,this.onSVGLoaded=null,this.elementManager=null,this.svgHelper=new SVGHelper}setLoadCallback(t){this.onSVGLoaded=t}setElementManager(t){this.elementManager=t}_addAppIds(t){return t.querySelectorAll("path, rect, circle, ellipse, line, polygon, polyline").forEach(t=>{t.dataset.appId||(t.dataset.appId=`app-id-${Math.random().toString(36).slice(2,11)}`)}),t}handleFileSelect(t){const e=t.target.files[0];e&&this.loadSVGFile(e)}handleDragOver(t){t.preventDefault(),t.currentTarget.classList.add("drag-over")}handleDragLeave(t){t.currentTarget.classList.remove("drag-over")}handleDrop(t){t.preventDefault(),t.currentTarget.classList.remove("drag-over");const e=t.dataTransfer.files;e.length>0&&this.loadSVGFile(e[0])}loadSVGFile(t){if(!t.name.toLowerCase().endsWith(".svg"))return void alert("Please select a valid SVG file.");const e=new FileReader;e.onload=e=>{try{this.parseSVG(e.target.result,t.name)}catch(t){console.error("Error parsing SVG:",t),alert("Error loading SVG file. Please check if the file is valid.")}},e.readAsText(t)}parseSVG(t,e="untitled.svg"){const i=(new DOMParser).parseFromString(t,"image/svg+xml");if(i.querySelector("parsererror"))throw new Error("Invalid SVG file");const s=this.svgHelper.getSVGRoot(i.documentElement);this._addAppIds(s),this.masterSVGElement=s,this.svgElement=this.masterSVGElement,this.fileName=e,this.svg=(new XMLSerializer).serializeToString(this.masterSVGElement),this.measurementSystem.detectUnits(this.masterSVGElement),this.onSVGLoaded&&this.onSVGLoaded(this.masterSVGElement,this.svg,this.fileName)}getSVGData(){return this.masterSVGElement&&(this.svg=(new XMLSerializer).serializeToString(this.masterSVGElement)),this.svg}getSVGElement(){return this.masterSVGElement}updateSVGData(){this.masterSVGElement&&(this.svg=(new XMLSerializer).serializeToString(this.masterSVGElement))}prepareElementForExport(t){ShaperUtils.removeTempClasses(t),this.updateShaperAttributesForExport(t),ShaperUtils.removeAllRawAttributes(t)}updateShaperAttributesForExport(t){if(!this.elementManager)return;const e=this.svgHelper.getSVGRoot(t);this.svgHelper.ensureShaperNamespace(e);const i=this.elementManager.getElementDimensions(t).shaperAttributes||{};ShaperConstants.MEASUREMENT_ATTRIBUTES.forEach(e=>{const s=i[`shaper:${e}`];if(s&&""!==s.trim()){const i=parseFloat(s);if(!isNaN(i)){const s=this.measurementSystem.convertPixelsToCurrentUnit(i),n=`${this.measurementSystem.formatDisplayNumber(s)}${this.measurementSystem.units}`;ShaperUtils.setNamespacedAttribute(t,e,n)}}else t.removeAttributeNS(ShaperConstants.NAMESPACE,e)});const s=i["shaper:cutType"];s&&""!==s.trim()?ShaperUtils.setNamespacedAttribute(t,"cutType",s):t.removeAttributeNS(ShaperConstants.NAMESPACE,"cutType")}exportSVG(){if(!this.getSVGData())return void alert("No SVG file loaded to export.");const t=this.masterSVGElement.cloneNode(!0);t.querySelectorAll("[data-app-id]").forEach(t=>{this.updateShaperAttributesForExport(t),ShaperUtils.removeAllRawAttributes(t),t.removeAttribute("data-app-id")});const e=(new XMLSerializer).serializeToString(t),i=new Blob([e],{type:"image/svg+xml"}),s=URL.createObjectURL(i),n=document.createElement("a");n.href=s,n.download=this.fileName||"shaper-file.svg",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}clearSVG(){this.svg=null,this.svgElement=null,this.masterSVGElement=null}hasLoadedSVG(){return null!==this.masterSVGElement}getCleanSVGClone(){if(!this.svg)return null;const t=(new DOMParser).parseFromString(this.svg,"image/svg+xml").documentElement;return t.querySelectorAll(".no-export, .svg-boundary-outline, .boundary-overlay, .path-overlay").forEach(t=>t.remove()),t}}window.FileManager=FileManager;class AttributeSystem{constructor(t,e,i){this.measurementSystem=t,this.fileManager=e,this.elementManager=i}getShaperAttributes(t){const e={};return ShaperConstants.ALL_ATTRIBUTES.forEach(i=>{const s=t.getAttributeNS(ShaperConstants.NAMESPACE,i);s&&(e[i]=s)}),e}setShaperAttribute(t,e,i){ShaperUtils.setNamespacedAttribute(t,e,i)}saveAttributes(){const t=this.getSelectedPath();t?(this.saveCutTypeAttribute(t),this.saveMeasurementAttributes(t),this.fileManager.updateSVGData(),console.log("AttributeSystem.saveAttributes completed")):console.error("No selected path found")}saveCutTypeAttribute(t){const e=document.getElementById("cutType").value.trim(),i=this.elementManager.getElementDimensions(t);i.shaperAttributes||(i.shaperAttributes={}),ShaperConstants.isEmptyValue(e)||"none"===e?delete i.shaperAttributes["shaper:cutType"]:i.shaperAttributes["shaper:cutType"]=e}saveMeasurementAttributes(t){const e=this.elementManager.getElementDimensions(t);e.shaperAttributes||(e.shaperAttributes={}),ShaperConstants.MEASUREMENT_ATTRIBUTES.forEach(t=>{const i=document.getElementById(t).value.trim(),s=`shaper:${t}`;if(ShaperConstants.isEmptyValue(i))delete e.shaperAttributes[s];else{const t=this.measurementSystem.stripUnitsFromValue(i);if(!isNaN(t)){const i=this.measurementSystem.unitsToPixels(t);e.shaperAttributes[s]=i.toString()}}})}convertAttributeValues(t,e){t!==e&&this.fileManager.updateSVGData()}refreshDialogValues(){const t=this.getSelectedPath();if(!t)return;const e=this.elementManager.getElementDimensions(t).shaperAttributes||{};ShaperConstants.MEASUREMENT_ATTRIBUTES.forEach(t=>{const i=document.getElementById(t),s=e[`shaper:${t}`];if(s&&""!==s.trim()&&i){const t=parseFloat(s);if(!isNaN(t)){const e=this.measurementSystem.convertPixelsToCurrentUnit(t),s=this.measurementSystem.formatDisplayNumber(e);i.value=s}}else i&&(i.value="")});const i=e["shaper:cutType"]||"",s=document.getElementById("cutType");s&&(s.value=i)}getSelectedPath(){return this.elementManager?this.elementManager.getSelectedPath():null}validateAttributes(t,e,i){const s={cutDepth:t,cutOffset:e,toolDia:i};return ShaperUtils.validateAllAttributes(s)}getElementsWithShaperAttributes(){const t=this.fileManager.getSVGElement();return t?Array.from(t.querySelectorAll("*")).filter(t=>ShaperConstants.ALL_ATTRIBUTES.some(e=>t.getAttributeNS(ShaperConstants.NAMESPACE,e))):[]}clearShaperAttributes(t){ShaperUtils.removeAllRawAttributes(t)}copyShaperAttributes(t,e){const i=this.getShaperAttributes(t);Object.entries(i).forEach(([t,i])=>{this.setShaperAttribute(e,t,i)})}getShaperAttributesSummary(){const t=this.getElementsWithShaperAttributes(),e={totalElements:t.length,cutTypes:new Set,depthRange:{min:null,max:null},offsetRange:{min:null,max:null},toolDiameters:new Set};return t.forEach(t=>{const i=this.elementManager.getElementDimensions(t).shaperAttributes||{},s=i["shaper:cutType"];s&&e.cutTypes.add(s),["cutDepth","cutOffset"].forEach(t=>{const s=i[`shaper:${t}`];if(s&&""!==s.trim()){const i=parseFloat(s);if(!isNaN(i)){const s=this.measurementSystem.convertBetweenUnits(i,"px","mm"),n="cutDepth"===t?e.depthRange:e.offsetRange;(null===n.min||s<n.min)&&(n.min=s),(null===n.max||s>n.max)&&(n.max=s)}}});const n=i["shaper:toolDia"];if(n&&""!==n.trim()){const t=parseFloat(n);if(!isNaN(t)){const i=this.measurementSystem.convertBetweenUnits(t,"px","mm"),s=this.measurementSystem.formatDisplayNumber(i);e.toolDiameters.add(`${s}mm`)}}}),e.cutTypes=Array.from(e.cutTypes),e.toolDiameters=Array.from(e.toolDiameters),e}}window.AttributeSystem=AttributeSystem;class SVGShaperEditor{constructor(){this.measurementSystem=new MeasurementSystem,this.fileManager=new FileManager(this.measurementSystem),this.elementDataMap=new Map,this.elementManager=new ElementManager(this.measurementSystem,this.fileManager,this.elementDataMap),this.viewport=new Viewport,this.uiComponents=new UIComponents(this.measurementSystem,this.elementManager),this.attributeSystem=new AttributeSystem(this.measurementSystem,this.fileManager,this.elementManager),this.svgHelper=new SVGHelper,this.initializeElements(),this.bindEvents(),this.setupModuleConnections(),this.boundaryTooltipActive=!1,this.isLoadingFromLocalStorage=!1,this.debugOverlayEnabled=!0}initializeElements(){this.uploadSection=document.getElementById("uploadSection"),this.editorSection=document.getElementById("editorSection"),this.fileInput=document.getElementById("fileInput"),this.uploadArea=document.getElementById("uploadArea"),this.uploadButton=document.getElementById("uploadBtn"),this.floatingImportBtn=document.getElementById("floatingImportBtn"),this.floatingExportBtn=document.getElementById("floatingExportBtn"),this.svgContainer=document.getElementById("svgContainer"),this.svgWrapper=document.getElementById("svgWrapper"),this.svgContent=document.getElementById("svgContent"),this.gutterOverlay=document.getElementById("gutterOverlay"),this.unitsToggle=document.getElementById("unitToggle"),this.decimalToggle=document.getElementById("decimalToggle"),this.gutterToggle=document.getElementById("gutterToggle"),this.gutterSize=document.getElementById("gutterSize"),this.gutterUnitLabel=document.getElementById("gutterUnitLabel"),this.zoomInBtn=document.getElementById("zoomIn"),this.zoomOutBtn=document.getElementById("zoomOut"),this.zoom100Btn=document.getElementById("zoom100"),this.zoomFitBtn=document.getElementById("zoomFit"),this.centerViewBtn=document.getElementById("centerView"),this.currentFileNameDisplay=document.getElementById("titlebarFilename"),this.uiComponents.initializeElements()}setupModuleConnections(){this.fileManager.setElementManager(this.elementManager),this.fileManager.setLoadCallback((t,e,i)=>{if(this.currentFileName=i,this.updateFileNameDisplay(),this.showEditor(),this.isLoadingFromLocalStorage){this.measurementSystem.analyzeSVG(t).forEach((t,e)=>{const i=this.elementDataMap.get(e);i&&i.shaperAttributes&&(t.shaperAttributes=i.shaperAttributes),this.elementDataMap.set(e,t)})}else{this.elementDataMap.clear();this.measurementSystem.analyzeSVG(t).forEach((t,e)=>this.elementDataMap.set(e,t))}this.displaySVG(t),this.isLoadingFromLocalStorage||(this.viewport.resetViewport(),this.saveToLocalStorage())}),this.uiComponents.saveAttributes=()=>{this.attributeSystem.saveAttributes(),this.fileManager.updateSVGData(),this.saveToLocalStorage(),this.uiComponents.refreshTooltipIfVisible(),this.uiComponents.closeModal()},this.attributeSystem.editor=this,this.uiComponents.editor=this,this.viewport.onZoomChange=()=>{this.updateGutterSize()},this.viewport.onViewportChange=()=>{this.saveToLocalStorage()},this.viewport.onViewportDragEnd=()=>{this.saveViewportOnly()},this.uiComponents.onExportSVG=()=>{this.fileManager.exportSVG()},this.uiComponents.onCopyToClipboard=()=>{this.copyToClipboard()},this.uiComponents.onZoomToFit=()=>{this.viewport.zoomToFit()},this.uiComponents.onCenterView=()=>{this.viewport.centerView()},this.uiComponents.onZoom100=()=>{this.viewport.zoomTo100()},this.loadFromLocalStorage()}saveToLocalStorage(){this.saveFullSettings()}saveViewportOnly(){try{const t=localStorage.getItem("shaperEditorSettings");let e=t?JSON.parse(t):{};e.zoom=this.viewport.getZoom(),e.panX=this.viewport.getPan().x,e.panY=this.viewport.getPan().y,localStorage.setItem("shaperEditorSettings",JSON.stringify(e))}catch(t){console.warn("Failed to save viewport state:",t)}}saveFullSettings(){const t=this.getRawValue(this.gutterSize),e={gutterEnabled:this.gutterToggle.checked,units:this.measurementSystem.units,decimalSeparator:this.measurementSystem.decimalSeparator,gutterSizeRawMm:isNaN(t)?parseFloat(this.gutterSize.value)||10:t,zoom:this.viewport.getZoom(),panX:this.viewport.getPan().x,panY:this.viewport.getPan().y,dpi:this.measurementSystem.dpi,elementData:Array.from(this.elementDataMap.entries()).map(([t,e])=>({elementId:t,data:e})),originalSVG:this.fileManager.svg?{svg:this.fileManager.svg,fileName:this.currentFileName||"untitled.svg"}:null,displayCloneSVG:this.svgContent.innerHTML,measurementCloneSVG:this.measurementSystem.lastMeasurementCloneHTML,boundaryDebug:this.getBoundaryDebugInfo()};localStorage.setItem("shaperEditorSettings",JSON.stringify(e))}loadFromLocalStorage(){try{const t=localStorage.getItem("shaperEditorSettings");if(t){const e=JSON.parse(t);console.log("Parsed settings:",e),"boolean"==typeof e.gutterEnabled&&(this.gutterToggle.checked=e.gutterEnabled,this.gutterOverlay.style.display=e.gutterEnabled?"block":"none"),this.debugOverlayEnabled=!0;const i=document.getElementById("gridDebugOverlay");i&&(i.style.display="block"),this.applySetting(e.units,["mm","in"],t=>{this.measurementSystem.setUnits(t),this.updateUnitDisplay()},this.unitsToggle,t=>"in"===t),this.applySetting(e.decimalSeparator,[".",","],t=>this.measurementSystem.setDecimalSeparator(t),this.decimalToggle,t=>","===t);let s=e.gutterSizeRawMm;if(s||!e.gutterSize||isNaN(parseFloat(e.gutterSize))||(s=parseFloat(e.gutterSize),"in"===e.units&&s<5&&(s*=25.4)),s&&!isNaN(parseFloat(s))){this.setRawValue(this.gutterSize,s);const t=this.measurementSystem.convertBetweenUnits(s,"mm",this.measurementSystem.units);this.gutterSize.value=this.measurementSystem.formatDisplayNumber(t)}if(this.updateGutterSize(),e.elementData&&Array.isArray(e.elementData)&&(console.log("Restoring elementData from localStorage:",e.elementData.length,"elements"),this.elementDataMap.clear(),e.elementData.forEach(t=>{t.elementId&&t.data&&this.elementDataMap.set(t.elementId,t.data)})),e.originalSVG&&e.originalSVG.svg)try{this.isLoadingFromLocalStorage=!0,this.currentFileName=e.originalSVG.fileName||"untitled.svg",this.updateFileNameDisplay(),this.fileManager.parseSVG(e.originalSVG.svg,this.currentFileName),setTimeout(()=>{this.restoreViewportState(e),this.isLoadingFromLocalStorage=!1,this.saveToLocalStorage()},0)}catch(t){console.error("Error restoring last opened file:",t),this.isLoadingFromLocalStorage=!1}}}catch(t){console.error("Error loading settings from localStorage:",t)}}restoreViewportState(t){const e=this.viewport.onViewportChange;this.viewport.onViewportChange=null,"number"!=typeof t.zoom||isNaN(t.zoom)||this.viewport.setZoom(Math.max(.1,Math.min(t.zoom,10))),"number"!=typeof t.panX||isNaN(t.panX)||this.viewport.setPan(t.panX,t.panY||0),this.viewport.updateTransform(),this.viewport.updateZoomLevel(),this.viewport.onViewportChange=e,console.log("Viewport state restored:",{zoom:this.viewport.getZoom(),pan:this.viewport.getPan()})}applySetting(t,e,i,s,n){if(e.includes(t)){const e=this.isLoadingFromLocalStorage;this.isLoadingFromLocalStorage=!0,i(t),this.isLoadingFromLocalStorage=e,s&&(s.checked=n(t))}}bindEvents(){this.fileInput.addEventListener("change",t=>{this.fileManager.handleFileSelect(t)}),this.uploadArea.addEventListener("click",t=>{t.target.closest("#uploadBtn")||this.fileInput.click()}),this.uploadArea.addEventListener("dragover",t=>this.fileManager.handleDragOver(t)),this.uploadArea.addEventListener("dragleave",t=>this.fileManager.handleDragLeave(t)),this.uploadArea.addEventListener("drop",t=>this.fileManager.handleDrop(t)),this.uploadButton.addEventListener("click",()=>this.fileInput.click()),this.floatingImportBtn.addEventListener("click",()=>this.fileInput.click()),this.floatingExportBtn.addEventListener("click",()=>this.fileManager.exportSVG()),this.gutterSize.addEventListener("blur",()=>this.handleGutterInput()),this.gutterSize.addEventListener("keypress",t=>{"Enter"===t.key&&this.gutterSize.blur()}),this.unitsToggle.addEventListener("change",()=>this.toggleUnits()),this.decimalToggle.addEventListener("change",()=>this.toggleDecimalSeparator()),this.gutterToggle.addEventListener("change",()=>this.toggleGutter()),this.viewport.setupZoomInput(),this.zoomInBtn.addEventListener("click",()=>{this.viewport.zoomIn(),this.updateGutterSize()}),this.zoomOutBtn.addEventListener("click",()=>{this.viewport.zoomOut(),this.updateGutterSize()}),this.zoom100Btn.addEventListener("click",()=>{this.viewport.zoomTo100(),this.updateGutterSize()}),this.zoomFitBtn.addEventListener("click",()=>{this.viewport.zoomToFit(),this.updateGutterSize()}),this.centerViewBtn.addEventListener("click",()=>{this.viewport.centerView()}),document.getElementById("modalClose").addEventListener("click",()=>this.uiComponents.closeModal()),document.getElementById("modalCancel").addEventListener("click",()=>this.uiComponents.closeModal()),document.getElementById("modalSave").addEventListener("click",()=>{this.uiComponents.saveAttributes()}),window.addEventListener("click",t=>{t.target===this.uiComponents.modal&&this.uiComponents.closeModal()}),["cutDepth","cutOffset","toolDia"].forEach(t=>{const e=document.getElementById(t);e?e.addEventListener("blur",()=>{this.normalizeInput(e)}):console.error(`Could not find input element: ${t}`)}),document.addEventListener("keydown",t=>this.uiComponents.handleKeyDown(t)),document.addEventListener("keydown",t=>{if(!t.metaKey&&!t.ctrlKey||t.shiftKey||t.altKey||"g"!==t.key.toLowerCase()||(t.preventDefault(),this.toggleDebugOverlayVisibility()),(t.metaKey||t.ctrlKey)&&!t.shiftKey&&!t.altKey&&("0"===t.key||"Digit0"===t.code)){const e=t.target&&t.target.tagName?t.target.tagName.toLowerCase():"";if("input"===e||"textarea"===e||t.target.isContentEditable)return;t.preventDefault(),this.viewport&&"function"==typeof this.viewport.zoomToFit&&(this.viewport.zoomToFit(),this.updateGutterSize(),this.showNotification("Zoom to Fit","info"))}})}displaySVG(t){this.svgContent.innerHTML="";const e=this.svgHelper.cloneSVGElement(t,this.svgContent);this.addBoundaryOutline(e),this.viewport.setSVGElements(this.svgWrapper,e),this.addOverlaysToDisplayedSVG(e),this.showEditor()}addBoundaryOutline(t){const e=this.svgHelper.createBoundaryOutline(t);t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}addOverlaysToDisplayedSVG(t){t.querySelectorAll(ShaperConstants.ELEMENT_SELECTORS).forEach(t=>{if(t.classList.contains(ShaperConstants.CSS_CLASSES.BOUNDARY_OUTLINE))return void this.addBoundaryOutlineWithOverlay(t);const e=this.elementManager.createPathOverlay(t);t.parentNode.insertBefore(e,t.nextSibling),e.addEventListener("mouseover",()=>{console.log("MOUSEOVER detected on overlay!")}),e.addEventListener("click",i=>{console.log("Overlay clicked!",e),i.stopPropagation(),this.uiComponents.openAttributeModal(t)}),e.addEventListener("mousedown",t=>{}),e.addEventListener("mouseenter",i=>{console.log("Overlay mouse enter!",e),t.classList.add(ShaperConstants.CSS_CLASSES.HOVER),this.elementManager.setHoveredPath(t),this.uiComponents.showTooltip(t,i.clientX,i.clientY)}),e.addEventListener("mousemove",t=>{this.viewport.updateMousePosition(t.clientX,t.clientY),this.uiComponents.setMousePosition(t.clientX,t.clientY),this.uiComponents.updateTooltipPosition(t.clientX,t.clientY)}),e.addEventListener("mouseleave",e=>{t.classList.remove(ShaperConstants.CSS_CLASSES.HOVER),this.elementManager.setHoveredPath(null),this.uiComponents.hideTooltip()})}),this.svgWrapper.addEventListener("wheel",t=>this.viewport.handleWheel(t)),this.svgWrapper.addEventListener("mousedown",t=>this.viewport.handleMouseDown(t)),this.svgWrapper.addEventListener("touchstart",t=>this.viewport.handleTouchStart(t),{passive:!1}),this.svgWrapper.addEventListener("touchmove",t=>this.viewport.handleTouchMove(t),{passive:!1}),this.svgWrapper.addEventListener("touchend",t=>this.viewport.handleTouchEnd(t)),this.svgWrapper.addEventListener("mousemove",t=>{if(this.viewport.handleMouseMove(t),this.boundaryTooltipActive){if(!t.target.classList.contains("boundary-overlay")){this.svgWrapper.querySelectorAll(".svg-boundary-outline").forEach(t=>t.classList.remove("boundary-highlight")),this.uiComponents.hideTooltip(),this.boundaryTooltipActive=!1}}}),this.svgWrapper.addEventListener("mouseup",t=>this.viewport.handleMouseUp(t))}addBoundaryOutlineEvents(t){t.addEventListener("mouseenter",e=>{this.uiComponents.showBoundaryTooltip(t,e.clientX,e.clientY)}),t.addEventListener("mousemove",t=>{this.viewport.updateMousePosition(t.clientX,t.clientY),this.uiComponents.setMousePosition(t.clientX,t.clientY),this.uiComponents.updateTooltipPosition(t.clientX,t.clientY)}),t.addEventListener("mouseleave",t=>{this.uiComponents.hideTooltip()})}addBoundaryOutlineWithOverlay(t){const e=t.getAttribute("d"),i=e.match(/M\s*([0-9.-]+)\s+([0-9.-]+)\s+L\s*([0-9.-]+)\s+([0-9.-]+)\s+L\s*([0-9.-]+)\s+([0-9.-]+)\s+L\s*([0-9.-]+)\s+([0-9.-]+)/);if(!i)return void console.error("Could not parse boundary path data:",e);const s=parseFloat(i[1]),n=parseFloat(i[2]),a=parseFloat(i[3])-s,o=parseFloat(i[6])-n,r=`${`M ${s-5} ${n-5} L ${s+a+5} ${n-5} L ${s+a+5} ${n+o+5} L ${s-5} ${n+o+5} Z`} ${`M ${s} ${n} L ${s+a} ${n} L ${s+a} ${n+o} L ${s} ${n+o} Z`}`,l=this.svgHelper.createPath(r,{fill:"transparent","fill-rule":"evenodd",cursor:"pointer",class:`boundary-overlay ${ShaperConstants.CSS_CLASSES.NO_EXPORT}`});t.parentNode.appendChild(l),l.addEventListener("mouseenter",e=>{t.classList.add("boundary-highlight"),this.uiComponents.showBoundaryTooltip(t,e.clientX,e.clientY),this.boundaryTooltipActive=!0}),l.addEventListener("mousedown",t=>{}),l.addEventListener("mousemove",t=>{this.viewport.updateMousePosition(t.clientX,t.clientY),this.uiComponents.setMousePosition(t.clientX,t.clientY),this.uiComponents.updateTooltipPosition(t.clientX,t.clientY)}),l.addEventListener("mouseleave",e=>{t.classList.remove("boundary-highlight"),this.uiComponents.hideTooltip(),this.boundaryTooltipActive=!1})}showEditor(){this.uploadSection.style.display="none",this.editorSection.style.display="block",this.updateUnitDisplay()}updateFileNameDisplay(){if(this.currentFileNameDisplay){const t=this.currentFileNameDisplay.querySelector(".filename-text");this.currentFileName?(t?t.textContent=this.currentFileName:this.currentFileNameDisplay.textContent=this.currentFileName,this.currentFileNameDisplay.style.display="inline-flex"):this.currentFileNameDisplay.style.display="none"}}newFile(){this.fileManager.clearSVG(),this.svgContent.innerHTML="",this.elementManager.selectPath(null),this.fileInput.value="",this.currentFileName=null,this.updateFileNameDisplay(),this.uiComponents.closeModal(),this.fileInput&&this.fileInput.click()}toggleGutter(){this.gutterToggle.checked?(this.gutterOverlay.style.setProperty("display","block","important"),this.updateGutterSize()):this.gutterOverlay.style.setProperty("display","none","important"),this.saveToLocalStorage()}handleGutterInput(){this.normalizeInput(this.gutterSize);const t=this.gutterSize.value;t&&!isNaN(parseFloat(t))&&this.initializeRawValue(this.gutterSize,t,this.measurementSystem.units),this.updateGutterSize(),this.saveToLocalStorage()}normalizeInput(t){if(""===t.value.trim())return;this.updateRawValueFromDisplay(t,this.measurementSystem.units);const e=this.getRawValue(t);if(!isNaN(e)){const i=this.measurementSystem.convertBetweenUnits(e,"mm",this.measurementSystem.units),s=this.measurementSystem.formatDisplayNumber(i);t.value=s}}updateGutterSize(){if(!this.gutterToggle.checked)return;if(!this.gutterSize||!this.gutterOverlay)return;let t=this.getRawValue(this.gutterSize);if(isNaN(t)||t<=0){const e=this.measurementSystem.parseValueWithUnits(this.gutterSize.value);t=!isNaN(e)&&e>0?this.measurementSystem.convertBetweenUnits(e,this.measurementSystem.units,"mm"):10,this.setRawValue(this.gutterSize,t)}const e=this.measurementSystem.convertBetweenUnits(t,"mm","px");if(!(e>0))return void this._updateGridDebugOverlay({error:"baseCellPx <= 0",gutterRawMm:t});this.gutterOverlay.dataset.baseCell=e.toString();const i=this.svgContent.querySelector("svg");let s=null,n=null;if(i){const t=this.measurementSystem.measureSVGBoundaryWithClone(i,this.fileManager);t&&t.width&&(s=t.width,n=t.method)}let a=null,o=null,r=null;s&&(r=this.measurementSystem.convertBetweenUnits(s,"px","mm"),a=r/t,o=s/e),this.viewport&&"function"==typeof this.viewport.updateInfiniteGrid&&this.viewport.updateInfiniteGrid();const l={gutterRawMm:t,baseCellPx:e,boundaryPx:s,expectedCells:a,actualCells:o,totalLogicalMm:r,pxPerMm:e/t,zoom:this.viewport?this.viewport.getZoom():1,units:this.measurementSystem.units,dpi:this.measurementSystem.dpi,method:n||"n/a",anchorLogicalX:this.viewport?this.viewport.anchorLogicalX:0,anchorLogicalY:this.viewport?this.viewport.anchorLogicalY:0,anchorScreenX:this.viewport?this.viewport.getZoom()*(this.viewport.anchorLogicalX||0)+(this.viewport.getPan().x||0):0,anchorScreenY:this.viewport?this.viewport.getZoom()*(this.viewport.anchorLogicalY||0)+(this.viewport.getPan().y||0):0};this.lastGridDebugData=l,this._updateGridDebugOverlay(l)}_updateGridDebugOverlay(t){if(!this.debugOverlayEnabled){const t=document.getElementById("gridDebugOverlay");return void(t&&(t.style.display="none"))}let e=document.getElementById("gridDebugOverlay");if(!e){e=document.createElement("div"),e.id="gridDebugOverlay",e.style.cssText=["position:absolute","bottom:8px","right:8px","z-index:4000","background:rgba(10,14,20,0.85)","backdrop-filter:blur(4px)","color:#e6f1ff","font:11px/1.35 monospace","padding:10px 12px 14px 12px","border:1px solid #2a3b4d","border-radius:8px","max-width:300px","white-space:pre-wrap","user-select:text","pointer-events:auto"].join(";");(this.editorSection||document.body).appendChild(e);const t=document.createElement("button");t.textContent="COPY",t.type="button",t.style.cssText=["position:absolute","top:4px","left:4px","padding:2px 6px","font:10px monospace","border:1px solid #3a4a5a","background:#1e2a3a","color:#fff","border-radius:4px","cursor:pointer"].join(";"),t.addEventListener("click",i=>{i.stopPropagation();const s=e.dataset.rawText||e.textContent||"";navigator.clipboard.writeText(s).then(()=>{t.textContent="✓",setTimeout(()=>t.textContent="COPY",1100)}).catch(()=>{t.textContent="ERR",setTimeout(()=>t.textContent="COPY",1500)})}),e.appendChild(t)}const i=(t,e=3)=>null==t||isNaN(t)?"-":parseFloat(t).toFixed(e);if(t.error)return e.dataset.rawText=`[GRID]\nERROR: ${t.error}`,void(e.innerHTML=e.innerHTML.split("</button>").shift()+"</button>"+`<pre style="margin:18px 0 0">[GRID]\nERROR: ${t.error}</pre>`);const s=["GRID DEBUG",`gutterRawMm:      ${i(t.gutterRawMm)}`,`baseCellPx:       ${i(t.baseCellPx)}`,`pxPerMm(const):  ${i(t.pxPerMm,4)}`,`zoom:            ${i(t.zoom,2)}`,"",`boundaryWidthPx:  ${i(t.boundaryPx)}`,`totalWidthMm:     ${i(t.totalLogicalMm)}`,"",`expectedCells:    ${i(t.expectedCells,3)}`,`actualCells:      ${i(t.actualCells,3)}`,"",`units(display):   ${t.units||"-"}`,`dpi:              ${t.dpi}`,`measureMethod:    ${t.method}`,"",`anchorLogicalX:   ${i(t.anchorLogicalX,3)}`,`anchorLogicalY:   ${i(t.anchorLogicalY,3)}`,`anchorScreenX:    ${i(t.anchorScreenX,2)}`,`anchorScreenY:    ${i(t.anchorScreenY,2)}`,`timestamp:        ${(new Date).toISOString().split("T")[1].replace("Z","")}`];e.dataset.rawText=s.join("\n");const n=e.querySelector("button");Array.from(e.childNodes).forEach(t=>{t!==n&&e.removeChild(t)});const a=document.createElement("pre");a.style.cssText="margin:18px 0 0;padding:0;font:inherit;",a.textContent=s.join("\n"),e.appendChild(a),e.style.display="block"}toggleDebugOverlayVisibility(){this.debugOverlayEnabled=!this.debugOverlayEnabled;const t=document.getElementById("gridDebugOverlay");t?t.style.display=this.debugOverlayEnabled?"block":"none":this.debugOverlayEnabled&&this.updateGutterSize(),this.showNotification(this.debugOverlayEnabled?"Debug Overlay ON":"Debug Overlay OFF","info")}refreshGridDebugAnchors(t,e){if(!this.debugOverlayEnabled)return;if(!this.lastGridDebugData)return;const i=Object.assign({},this.lastGridDebugData);i.zoom=this.viewport?this.viewport.getZoom():i.zoom,i.anchorScreenX=t,i.anchorScreenY=e,this._updateGridDebugOverlay(i)}getBoundaryOffset(){const t=this.svgHelper.getSVGRoot(null,"svgWrapper");if(!t)return console.log("No SVG element found"),null;let e=0,i=0,s=0,n=0;const a=t.getAttribute("viewBox");if(a){const t=a.split(/\s+/);e=parseFloat(t[0])||0,i=parseFloat(t[1])||0,s=parseFloat(t[2])||0,n=parseFloat(t[3])||0}else s=parseFloat(t.getAttribute("width"))||0,n=parseFloat(t.getAttribute("height"))||0;const o=t.getBoundingClientRect(),r=this.svgWrapper.getBoundingClientRect();return{x:o.left-r.left+e,y:o.top-r.top+i}}updateUnitDisplay(){this.gutterUnitLabel&&(this.gutterUnitLabel.textContent=this.measurementSystem.units),this.gutterSize&&(this.gutterSize.placeholder="10",this.gutterSize.dataset.rawValueMm||this.setRawValue(this.gutterSize,10)),this.unitsToggle&&!this.isLoadingFromLocalStorage&&(this.unitsToggle.checked="in"===this.measurementSystem.units),this.decimalToggle&&!this.isLoadingFromLocalStorage&&(this.decimalToggle.checked=","===this.measurementSystem.decimalSeparator),this.uiComponents.updateDialogUnits(),this.isConverting||this.updateGutterSize()}toggleUnits(){const t=this.measurementSystem.units,e=this.unitsToggle.checked?"in":"mm";this.isConverting=!0,this.measurementSystem.setUnits(e),this.updateUnitDisplay(),this.convertGutterSize(t,e),this.convertDialogValues(t,e),this.attributeSystem.convertAttributeValues(t,e),this.isConverting=!1,this.uiComponents.refreshTooltip(),this.saveToLocalStorage()}toggleDecimalSeparator(){if(this.measurementSystem.setDecimalSeparator(this.decimalToggle.checked?",":"."),this.gutterSize){const t=this.getRawValue(this.gutterSize);if(!isNaN(t)){const e=this.measurementSystem.convertBetweenUnits(t,"mm",this.measurementSystem.units);this.gutterSize.value=this.measurementSystem.formatDisplayNumber(e)}}if(this.attributeSystem.refreshDialogValues(),this.uiComponents.modal&&"none"!==this.uiComponents.modal.style.display){const t=this.elementManager.getSelectedPath();t&&(this.uiComponents.selectedPathInfo.textContent=this.elementManager.getElementDescription(t))}this.uiComponents.refreshTooltip(),this.saveToLocalStorage()}convertGutterSize(t,e){t!==e&&this.gutterSize&&this.convertInputWithRawValue(this.gutterSize,"gutter",t,e)}convertDialogValues(t,e){if(t===e)return;["cutDepth","cutOffset","toolDia"].forEach(i=>{const s=document.getElementById(i);s&&s.value&&this.convertInputWithRawValue(s,i,t,e)})}getRawValue(t){return parseFloat(t.dataset.rawValueMm)}setRawValue(t,e){t.dataset.rawValueMm=e.toString()}initializeRawValue(t,e,i){if(!t.dataset.rawValueMm){const s=this.measurementSystem.parseValueWithUnits(e);if(null!==s&&s>0){const e=this.measurementSystem.convertBetweenUnits(s,i,"mm");return this.setRawValue(t,e),e}}return this.getRawValue(t)}updateRawValueFromDisplay(t,e){if(this.isConverting)return this.getRawValue(t);const i=t.value.trim();let s=i;if(i.includes(",")&&!i.includes("."))s=i.replace(",",".");else if(i.includes(".")&&i.includes(",")){s=i.lastIndexOf(",")>i.lastIndexOf(".")?i.replace(/\./g,"").replace(",","."):i.replace(/,/g,"")}const n=s.match(/^([+-]?\d*\.?\d+)\s*([a-zA-Z]*)$/);if(n){const[,i,s]=n,a=parseFloat(i);if(!isNaN(a)&&a>0){let i;return i="mm"===s?a:"in"===s?this.measurementSystem.convertBetweenUnits(a,"in","mm"):this.measurementSystem.convertBetweenUnits(a,e,"mm"),this.setRawValue(t,i),i}}return this.getRawValue(t)}convertInputWithRawValue(t,e,i,s){let n=this.getRawValue(t);if(isNaN(n)&&(n=this.initializeRawValue(t,t.value,i),isNaN(n)))return;const a=this.measurementSystem.convertBetweenUnits(n,"mm",s),o=this.measurementSystem.formatDisplayNumber(a);t.value=o}getBoundaryDebugInfo(){try{const t=this.svgContent.querySelector("svg");if(!t)return{error:"No SVG element found"};const e=this.measurementSystem.measureSVGBoundaryWithClone(t,this.fileManager),i=this.measurementSystem.convertBetweenUnits(e.width,"px","mm"),s=this.measurementSystem.convertBetweenUnits(e.height,"px","mm"),n=this.measurementSystem.convertBetweenUnits(e.width,"px","in"),a=this.measurementSystem.convertBetweenUnits(e.height,"px","in"),o=t.getAttribute("viewBox"),r=t.getAttribute("width"),l=t.getAttribute("height");return{measuringClone:{pixelWidth:e.width,pixelHeight:e.height,widthMm:i,heightMm:s,widthIn:n,heightIn:a},svgAttributes:{viewBox:o,width:r,height:l},detectedUnits:this.measurementSystem.detectedUnits,currentUnits:this.measurementSystem.units,dpi:this.measurementSystem.dpi,debugComparison:e.debugComparison||null,measurementMethod:e.method||"unknown",timestamp:(new Date).toISOString()}}catch(t){return{error:t.message,timestamp:(new Date).toISOString()}}}async copyToClipboard(){try{if(!this.fileManager.getSVGData())throw new Error("No SVG file loaded to copy");const t=this.fileManager.masterSVGElement.cloneNode(!0);t.querySelectorAll("[data-app-id]").forEach(t=>{this.fileManager.updateShaperAttributesForExport(t),ShaperUtils.removeAllRawAttributes(t),t.removeAttribute("data-app-id")});const e=(new XMLSerializer).serializeToString(t);if(navigator.clipboard&&window.ClipboardItem){const t=new Blob([e],{type:"image/svg+xml"}),i=new Blob([e],{type:"text/plain"}),s=new ClipboardItem({"image/svg+xml":t,"text/plain":i});await navigator.clipboard.write([s]),this.showNotification("SVG copied to clipboard!","success")}else await navigator.clipboard.writeText(e),this.showNotification("SVG code copied to clipboard!","success")}catch(t){console.error("Failed to copy to clipboard:",t),this.showNotification("Failed to copy to clipboard. Please use the export button instead.","error")}}showNotification(t,e="info"){const i=document.createElement("div");switch(i.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            padding: 12px 20px;\n            border-radius: 4px;\n            color: white;\n            font-weight: 500;\n            z-index: 10001;\n            max-width: 300px;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n            transition: opacity 0.3s ease;\n        ",e){case"success":i.style.backgroundColor="#4CAF50";break;case"error":i.style.backgroundColor="#f44336";break;default:i.style.backgroundColor="#2196F3"}i.textContent=t,document.body.appendChild(i),setTimeout(()=>{i.style.opacity="0",setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},300)},3e3)}}document.addEventListener("DOMContentLoaded",()=>{try{window.shaperEditor=new SVGShaperEditor}catch(t){console.error("Error initializing SVG Shaper Editor:",t)}})</script>