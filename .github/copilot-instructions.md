# Copilot Instructions for SVG Shaper Editor

This document provides essential guidance for AI agents contributing to the SVG Shaper Editor codebase.

## 1. Project Overview & Architecture

The "SVG Shaper Editor" is a client-side, vanilla JavaScript web application for editing "Shaper Tools" attributes (e.g., `shaper:cutType`, `shaper:cutDepth`) within SVG files. It runs entirely in the browser with no server-side components or build process.

The application's entry point is `ΔTune/index.html`. The core logic is modularized into several JavaScript classes located in `ΔTune/js/`.

### Key Architectural Components:

- **`SVGShaperEditor.js`**: The main application class. It initializes and orchestrates all other modules.
- **`fileManager.js`**: Handles file loading (drag-and-drop, file input) and exporting the modified SVG.
- **`viewport.js`**: Manages zooming and panning of the SVG canvas.
- **`measurementSystem.js`**: Handles unit conversions (mm/in), number formatting, and parsing.
- **`elementManager.js`**: Manages SVG elements, their properties, and creates interaction overlays.
- **`attributeSystem.js`**: Manages the business logic of reading, updating, and saving Shaper-specific attributes on SVG elements.
- **`uiComponents.js`**: Controls UI elements like the attribute editing modal, tooltips, and toolbar components.
- **`svgHelper.js`**: A crucial utility for creating, cleaning, and manipulating SVG elements, especially for export.
- **`shaperConstants.js`**: Stores shared constants like the `shaper` namespace URI, prefix, and CSS class names.

## 2. Core Concepts & Patterns

To be effective, it's critical to understand these project-specific patterns.

### Interaction Overlays

To preserve the integrity of the original SVG, user interactions (click, hover) are captured by invisible "overlay" elements, not the SVG paths themselves.
- These overlays are generated by `elementManager.js` for each interactive SVG element.
- They are marked with the `no-export` CSS class.
- **When adding or modifying interactions with SVG elements, you must edit the logic that creates and handles events on these overlays.**

### SVG Cleaning for Export

Before exporting, the SVG must be "cleaned" of all application-specific temporary elements (overlays, boundary outlines, hover effects).
- This is handled by `svgHelper.js` in the `createCleanSVGCopy` method.
- **When adding new temporary UI elements to the SVG canvas, ensure they are assigned the `no-export` class (`ShaperConstants.CSS_CLASSES.NO_EXPORT`) so they are correctly removed during export.**

### Unit and Measurement Handling

The application supports both `mm` and `in` and maintains precision during conversion.
- **Pattern:** Measurement input fields (like gutter size or cut depth) store their canonical value in millimeters in a `data-raw-value-mm` attribute.
- The value displayed to the user is converted from this raw `mm` value into the currently selected unit (`mm` or `in`).
- **When working with measurement inputs, always read from or write to the `data-raw-value-mm` attribute for internal logic. Use methods from `measurementSystem.js` for conversions and formatting for display.**

### State Persistence

The application state (current file, viewport settings, UI preferences) is saved to the browser's `localStorage` in `SVGShaperEditor.js` (`saveToLocalStorage`, `loadFromLocalStorage`). This allows the user's session to be restored. When adding new settings, integrate them into these functions.

## 3. Developer Workflow

- **Running the App**: There is no build step. Open `ΔTune/index.html` directly in a modern web browser.
- **Testing**: There is no formal test suite. Manual testing is required. Use the files in the `ΔTune/testfiles/` directory to test functionality.
- **Dependencies**: This is a vanilla JavaScript project with no external npm packages. All code is self-contained.
