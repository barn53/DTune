<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modal No-Modify Test</title>
    <link rel="stylesheet" href="../modal.css">
    <style>
        body {
            background: #2c3e50;
            font-family: 'IBM Plex Sans', sans-serif;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            color: white;
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px;
        }
        .test-results {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Modal No-Modify Functionality Test</h1>

        <div class="test-results" id="testResults">
            <h3>Test Results:</h3>
            <ul id="resultsList"></ul>
        </div>

        <button class="test-button" onclick="openTestModal()">Open Test Modal</button>
        <button class="test-button" onclick="runTests()">Run Tests</button>

        <!-- Modal HTML (copied from index.html) -->
        <div class="modal" id="attributeModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">
                        <img src="../icons/plan.svg" class="modal-icon" alt="Cut Planning">
                        Cut Planning
                        <span class="batch-counter" id="batchCounter">2</span>
                    </h2>
                    <button class="modal-close" id="modalClose">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="attributeForm">
                        <div class="form-group">
                            <label for="cutType" class="form-label">
                                <img src="../icons/cutType.svg" class="label-icon" alt="Cut Type">
                                Cut Type:
                            </label>
                            <div class="cut-type-slider">
                                <div class="cut-type-options">
                                    <div class="cut-type-option" data-type="">none</div>
                                    <div class="cut-type-option" data-type="online">Online</div>
                                    <div class="cut-type-option" data-type="inside">Inside</div>
                                    <div class="cut-type-option" data-type="outside">Outside</div>
                                    <div class="cut-type-option" data-type="pocket">Pocket</div>
                                    <div class="cut-type-option" data-type="guide">Guide</div>
                                    <div class="cut-type-option no-modify-option" data-type="no-modify">—</div>
                                </div>
                                <div class="cut-type-indicator"></div>
                            </div>
                            <input type="hidden" id="cutType" name="cutType" value="">
                        </div>
                        <div class="form-group">
                            <label for="cutDepth" class="form-label">
                                <img src="../icons/cutDepth.svg" class="label-icon" alt="Cut Depth">
                                Cut Depth:
                            </label>
                            <div class="input-container">
                                <div class="input-with-unit">
                                    <input type="text" id="cutDepth" name="cutDepth" placeholder="15"
                                        class="border-light rounded-sm large-input">
                                    <span class="input-unit">mm</span>
                                </div>
                                <div class="input-buttons">
                                    <button type="button" class="value-btn" data-target="cutDepth" data-value="1">1.0</button>
                                    <button type="button" class="value-btn" data-target="cutDepth" data-value="2">2.0</button>
                                    <button type="button" class="value-btn no-modify-btn" data-target="cutDepth" title="Don't modify this value">—</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="cutOffset" class="form-label">
                                <img src="../icons/cutOffset.svg" class="label-icon" alt="Cut Offset">
                                Cut Offset:
                            </label>
                            <div class="input-container">
                                <div class="input-with-unit">
                                    <input type="text" id="cutOffset" name="cutOffset" placeholder="0"
                                        class="border-light rounded-sm large-input">
                                    <span class="input-unit">mm</span>
                                </div>
                                <div class="input-buttons">
                                    <button type="button" class="value-btn" data-target="cutOffset" data-value="0">0.0</button>
                                    <button type="button" class="value-btn" data-target="cutOffset" data-value="0.1">0.1</button>
                                    <button type="button" class="value-btn no-modify-btn" data-target="cutOffset" title="Don't modify this value">—</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="toolDia" class="form-label">
                                <img src="../icons/toolDia.svg" class="label-icon" alt="Tool Diameter">
                                Tool Diameter:
                            </label>
                            <div class="input-container">
                                <div class="input-with-unit">
                                    <input type="text" id="toolDia" name="toolDia" placeholder="6"
                                        class="border-light rounded-sm large-input">
                                    <span class="input-unit">mm</span>
                                </div>
                                <div class="input-buttons">
                                    <button type="button" class="value-btn" data-target="toolDia" data-value="3">3.0</button>
                                    <button type="button" class="value-btn" data-target="toolDia" data-value="6">6.0</button>
                                    <button type="button" class="value-btn no-modify-btn" data-target="toolDia" title="Don't modify this value">—</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="modalCancel" class="btn btn-secondary">Cancel</button>
                    <button type="button" id="modalSave" class="btn btn-primary">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simple implementation of the toggleNoModify function to test
        function toggleNoModify(inputId) {
            const button = document.querySelector(`.no-modify-btn[data-target="${inputId}"]`);
            const input = document.getElementById(inputId);

            if (!button || !input) return;

            if (button.classList.contains('active')) {
                // Deactivate no-modify
                button.classList.remove('active');
                input.disabled = false;
                addTestResult(`✅ ${inputId}: No-modify deactivated, input enabled`);
            } else {
                // Activate no-modify
                button.classList.add('active');
                input.disabled = true;
                addTestResult(`✅ ${inputId}: No-modify activated, input disabled`);
            }

            // Check visual state
            checkInputVisualState(inputId);
        }

        function checkInputVisualState(inputId) {
            const input = document.getElementById(inputId);
            const computedStyle = window.getComputedStyle(input);

            if (input.disabled) {
                if (computedStyle.opacity === '0.6') {
                    addTestResult(`✅ ${inputId}: Disabled input has correct opacity (0.6)`);
                } else {
                    addTestResult(`❌ ${inputId}: Disabled input opacity is ${computedStyle.opacity}, expected 0.6`);
                }

                if (computedStyle.cursor === 'not-allowed') {
                    addTestResult(`✅ ${inputId}: Disabled input has correct cursor (not-allowed)`);
                } else {
                    addTestResult(`❌ ${inputId}: Disabled input cursor is ${computedStyle.cursor}, expected not-allowed`);
                }
            } else {
                if (computedStyle.opacity === '1') {
                    addTestResult(`✅ ${inputId}: Enabled input has correct opacity (1)`);
                } else {
                    addTestResult(`❌ ${inputId}: Enabled input opacity is ${computedStyle.opacity}, expected 1`);
                }
            }
        }

        function openTestModal() {
            document.getElementById('attributeModal').style.display = 'flex';
            addTestResult('✅ Modal opened');
        }

        function closeTestModal() {
            document.getElementById('attributeModal').style.display = 'none';
            addTestResult('✅ Modal closed');
        }

        function addTestResult(message) {
            const list = document.getElementById('resultsList');
            const item = document.createElement('li');
            item.textContent = message;
            list.appendChild(item);
        }

        function clearTestResults() {
            document.getElementById('resultsList').innerHTML = '';
        }

        function runTests() {
            clearTestResults();
            addTestResult('🔍 Starting No-Modify functionality tests...');

            // Open modal first
            openTestModal();

            // Test each input field
            setTimeout(() => {
                const inputs = ['cutDepth', 'cutOffset', 'toolDia'];

                inputs.forEach((inputId, index) => {
                    setTimeout(() => {
                        addTestResult(`\n--- Testing ${inputId} ---`);

                        // Test activating no-modify
                        toggleNoModify(inputId);

                        // Test deactivating no-modify
                        setTimeout(() => {
                            toggleNoModify(inputId);
                        }, 100);

                    }, index * 300);
                });

                // Close modal after tests
                setTimeout(() => {
                    closeTestModal();
                    addTestResult('\n🎉 Tests completed!');
                }, inputs.length * 300 + 500);

            }, 100);
        }

        // Set up event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Close modal when clicking close button or outside
            document.getElementById('modalClose').addEventListener('click', closeTestModal);
            document.getElementById('modalCancel').addEventListener('click', closeTestModal);

            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('attributeModal')) {
                    closeTestModal();
                }
            });

            // Set up no-modify button click handlers
            document.querySelectorAll('.no-modify-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const targetInputId = this.dataset.target;
                    toggleNoModify(targetInputId);
                });
            });

            addTestResult('✅ Test page loaded successfully');
        });
    </script>
</body>
</html>
